{{ if and (eq (getenv "HUGO_ENV") "production") .Site.Config.Services.GoogleAnalytics.ID }}
<!-- Cookie Consent Banner -->
<div id="cookie-consent-banner" style="display: none; position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: white; padding: 15px; text-align: center; z-index: 9999; box-shadow: 0 -2px 10px rgba(0,0,0,0.3);">
  <div style="max-width: 1200px; margin: 0 auto;">
    <p style="margin: 0 0 10px 0; font-size: 14px;">
      This website uses Google Analytics to help analyze how visitors use this site. By continuing to browse this site, you agree to this use.
      <a href="#" style="color: #4CAF50; text-decoration: underline;" onclick="showCookieDetails(); return false;">Learn more</a>
    </p>
    <div>
      <button onclick="acceptCookies()" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; margin: 0 5px; cursor: pointer; border-radius: 4px;">Accept</button>
      <button onclick="declineCookies()" style="background: #f44336; color: white; border: none; padding: 8px 16px; margin: 0 5px; cursor: pointer; border-radius: 4px;">Decline</button>
    </div>
  </div>
</div>

<!-- Cookie Details Modal -->
<div id="cookie-details-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%;">
    <h3 style="margin-top: 0;">Cookie Information</h3>
    <p>This website uses Google Analytics, which uses cookies to collect anonymous information about how visitors use this site. This information is used to improve the website experience.</p>
    <p><strong>What data is collected:</strong></p>
    <ul>
      <li>Pages visited and time spent on pages</li>
      <li>How you arrived at the site</li>
      <li>General location (country/city level)</li>
      <li>Device and browser information</li>
    </ul>
    <p>No personally identifiable information is collected. You can opt out at any time by declining cookies.</p>
    <button onclick="hideCookieDetails()" style="background: #2196F3; color: white; border: none; padding: 8px 16px; cursor: pointer; border-radius: 4px;">Close</button>
  </div>
</div>

<!-- Google Analytics Script (only loaded if consent given) -->
<script>
  // Check if user has already made a choice
  function getCookieConsent() {
    return localStorage.getItem('cookieConsent');
  }

  function setCookieConsent(value) {
    localStorage.setItem('cookieConsent', value);
  }

  function loadGoogleAnalytics() {
    // Google tag (gtag.js)
    var script1 = document.createElement('script');
    script1.async = true;
    script1.src = 'https://www.googletagmanager.com/gtag/js?id={{ .Site.Config.Services.GoogleAnalytics.ID }}';
    document.head.appendChild(script1);

    var script2 = document.createElement('script');
    script2.innerHTML = `
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ .Site.Config.Services.GoogleAnalytics.ID }}', {
        anonymize_ip: true,
        cookie_flags: 'SameSite=None;Secure'
      });
    `;
    document.head.appendChild(script2);
  }

  function acceptCookies() {
    setCookieConsent('accepted');
    document.getElementById('cookie-consent-banner').style.display = 'none';
    loadGoogleAnalytics();
  }

  function declineCookies() {
    setCookieConsent('declined');
    document.getElementById('cookie-consent-banner').style.display = 'none';
  }

  function showCookieDetails() {
    document.getElementById('cookie-details-modal').style.display = 'block';
  }

  function hideCookieDetails() {
    document.getElementById('cookie-details-modal').style.display = 'none';
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    var consent = getCookieConsent();
    
    if (consent === 'accepted') {
      loadGoogleAnalytics();
    } else if (consent === 'declined') {
      // Do nothing, no analytics
    } else {
      // Show banner if no choice has been made
      document.getElementById('cookie-consent-banner').style.display = 'block';
    }
  });
</script>
{{ end }}
