<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Jenkins on Stephen's technical blog</title><link>https://stephenc.github.io/tags/jenkins/</link><description>Recent content in Jenkins on Stephen's technical blog</description><generator>Hugo</generator><language>en-gb</language><lastBuildDate>Mon, 01 Oct 2012 00:00:00 +0000</lastBuildDate><atom:link href="https://stephenc.github.io/tags/jenkins/index.xml" rel="self" type="application/rss+xml"/><item><title>The Cross-Build Injection Attack Fallacy</title><link>https://stephenc.github.io/post/2012-10-01-the-cross-build-injection-attack-fallacy/</link><pubDate>Mon, 01 Oct 2012 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2012-10-01-the-cross-build-injection-attack-fallacy/</guid><description>&lt;p&gt;This is a repost of my post on the CloudBees Developers blog&lt;/p&gt;
&lt;p&gt;TL;DR Source control injection attacks are a bigger worry than build tool injection attacks, and if you cannot trust your local filesystem, then you cannot trust anything.&lt;/p&gt;
&lt;p&gt;A few exchanges on twitter have prompted me to write a fuller blog post on the subject of Cross-Build Injection (XBI) Attacks.&lt;/p&gt;
&lt;p&gt;The idea of XBI is that you trick the developer and replace parts of their code with your code, thereby getting your code to be trusted by the developer.&lt;/p&gt;</description></item><item><title>Backwards compatibility</title><link>https://stephenc.github.io/post/2011-05-01-backwards-compatibility/</link><pubDate>Sun, 01 May 2011 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2011-05-01-backwards-compatibility/</guid><description>&lt;p&gt;This is a tail about Jenkins (née Hudson) and Kohsuke&amp;rsquo;s policy of maintaining backwards compatibility&amp;hellip;&lt;/p&gt;
&lt;p&gt;Back in 2006 I started working for my previous employer, just a month or two after Peter Reilly started. Initially we were working on the same team. This was a team who&amp;rsquo;s CI system was a nightly cron job that emailed off a list of failing tests to everyone&amp;hellip; obviously Peter and I had many a WTF over that old system&amp;hellip; so I convinced our boss that we should put some effort into setting up a proper CI system&amp;hellip; Initially this was CruiseControl (as he thought Hudson at version 1.64 was too new and unheard of&amp;hellip; go with the old reliable)&amp;hellip; but after a couple of pains with the CruiseControl system (monolithic xml config file), we convinced him to switch to Hudson&amp;hellip; (I don&amp;rsquo;t think we ever looked back!)&lt;/p&gt;</description></item><item><title>Keeping Hudson configuration and data in SVN</title><link>https://stephenc.github.io/post/2010-07-01-keeping-hudson-configuration-and-data-in-svn/</link><pubDate>Thu, 01 Jul 2010 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2010-07-01-keeping-hudson-configuration-and-data-in-svn/</guid><description>&lt;p&gt;We recently lost our hudson server due to a multiple disk failure in the RAID array storing our hudson configuration. [5 of the 15 disks died]&lt;/p&gt;
&lt;p&gt;So I&amp;rsquo;ve been looking into a backup script that will allow us to keep a backup of the configuration.  We use Maven for most of our builds, so the released artifacts are in our Maven Repository (which is hosted on two servers each with RAID arrays and using DRBD to mirror between the pair, with an rsync to a NAS in another cabinet and we are trying to get an rsych to an off-site storage going as well).&lt;/p&gt;</description></item><item><title>Writing a Hudson plugin (Part 7 - Putting it all together)</title><link>https://stephenc.github.io/post/2008-06-01-writing-a-hudson-plugin-part-7-putting-it-all-together/</link><pubDate>Sun, 01 Jun 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-06-01-writing-a-hudson-plugin-part-7-putting-it-all-together/</guid><description>&lt;p&gt;Life gets in the way&amp;hellip; but we&amp;rsquo;re back with our final installment! So where to start, let&amp;rsquo;s start with a publisher for freestyle builds, then we&amp;rsquo;ll add a publisher for Maven 2 builds&amp;hellip; These will both require some reports to display results, and then finally we&amp;rsquo;ll need the plugin entry point. But before we get into all that, perhaps I should briefly explain structured form submission supportDataBoundConstructorsHudson uses Stapler as it&amp;rsquo;s web framework. One of the things that Stapler provides is support for constructing objects from a JSON data model. Basically, if you have a class with a public constructor annotated with @DataBoundConstructor, Stapler will bind fields from a JSON object by matching the field name to the constructor parameter name. If a parameter also has a @DataBoundConstructor, then Stapler will recurse to construct this child object from the child JSON object.Note: The only hole in this (at the moment) is if you want to inject a variable class, i.e. it does not support the case where there are three ChildImpl classes all implementing Child, and all with @DataBoundConstructor and Parent&amp;rsquo;s constructor has a parameter which takes Child&amp;hellip; However, plans are afoot to fix this!JavaNCSSPublisherPublishers in Hudson must have a Descriptor, this will be registered with Hudson and allows Hudson to create Publisher instances which have the details for the project they are publishing. Descriptors are normally implemented as an inner class called DescriptorImpl and there is normally a static field of the publisher DESCRIPTOR that holds the Descriptor singleton. 99.995% of the time, you will want your publisher to have a @DataBoundConstructor, so without further delay, here is the publisher:package hudson.plugins.javancss;import hudson.maven.MavenModule;import hudson.maven.MavenModuleSet;import hudson.model.AbstractProject;import hudson.model.Action; import hudson.model.Descriptor;import hudson.plugins.helpers.AbstractPublisherImpl;import hudson.plugins.helpers.Ghostwriter;import hudson.tasks.BuildStepDescriptor;import hudson.tasks.Publisher;import net.sf.json.JSONObject;import org.kohsuke.stapler.DataBoundConstructor;import org.kohsuke.stapler.StaplerRequest;public class JavaNCSSPublisher extends AbstractPublisherImpl { private String reportFilenamePattern; @DataBoundConstructor public JavaNCSSPublisher(String reportFilenamePattern) { reportFilenamePattern.getClass(); this.reportFilenamePattern = reportFilenamePattern; } public String getReportFilenamePattern() { return reportFilenamePattern; } public boolean needsToRunAfterFinalized() { return false; } public static final DescriptorImpl DESCRIPTOR = new DescriptorImpl(); public Descriptor&lt;!-- raw HTML omitted --&gt; getDescriptor() { return DESCRIPTOR; } public Action getProjectAction(AbstractProject&lt;!-- raw HTML omitted --&gt; project) { return new JavaNCSSProjectIndividualReport(project); } protected Ghostwriter newGhostwriter() { return new JavaNCSSGhostwriter(reportFilenamePattern); } public static final class DescriptorImpl extends BuildStepDescriptor&lt;!-- raw HTML omitted --&gt; { private DescriptorImpl() { super(JavaNCSSPublisher.class); } public String getDisplayName() { return &amp;ldquo;Publish &amp;quot; + PluginImpl.DISPLAY_NAME; } public boolean isApplicable(Class&lt;!-- raw HTML omitted --&gt;&amp;gt; extends AbstractBuildAction&lt;!-- raw HTML omitted --&gt; { private final Collection&lt;!-- raw HTML omitted --&gt; results; private final Statistic totals; public AbstractBuildReport(Collection&lt;!-- raw HTML omitted --&gt; results) { this.results = results; this.totals = Statistic.total(results); } public Collection&lt;!-- raw HTML omitted --&gt; getResults() { return results; } public Statistic getTotals() { return totals; } public String getSummary() { AbstractBuild&lt;!-- raw HTML omitted --&gt; prevBuild = getBuild().getPreviousBuild(); while (prevBuild != null &amp;amp;&amp;amp; prevBuild.getAction(getClass()) == null) { prevBuild = prevBuild.getPreviousBuild(); } if (prevBuild == null) { return totals.toSummary(); } else { AbstractBuildReport action = prevBuild.getAction(getClass()); return totals.toSummary(action.getTotals()); } } public String getIconFileName() { return PluginImpl.ICON_FILE_NAME; } public String getDisplayName() { return PluginImpl.DISPLAY_NAME; } public String getUrlName() { return PluginImpl.URL; } public boolean isGraphActive() { return false; }}Similarly, we have AbstractProjectReport which will be used for project reports:package hudson.plugins.javancss;import java.io.IOException;import java.util.Collection;import java.util.Collections;import hudson.model.AbstractBuild;import hudson.model.AbstractProject;import hudson.model.ProminentProjectAction;import hudson.plugins.helpers.AbstractProjectAction;import hudson.plugins.javancss.parser.Statistic;import org.kohsuke.stapler.StaplerRequest;import org.kohsuke.stapler.StaplerResponse;public abstract class AbstractProjectReport&amp;lt;T extends AbstractProject&lt;!-- raw HTML omitted --&gt;&amp;gt; extends AbstractProjectAction&lt;!-- raw HTML omitted --&gt; implements ProminentProjectAction { public AbstractProjectReport(T project) { super(project); } public String getIconFileName() { for (AbstractBuild&lt;!-- raw HTML omitted --&gt; build = getProject().getLastBuild(); build != null; build = build.getPreviousBuild()) { final AbstractBuildReport action = build.getAction(getBuildActionClass()); if (action != null) { return PluginImpl.ICON_FILE_NAME; } } return null; } public String getDisplayName() { for (AbstractBuild&lt;!-- raw HTML omitted --&gt; build = getProject().getLastBuild(); build != null; build = build.getPreviousBuild()) { final AbstractBuildReport action = build.getAction(getBuildActionClass()); if (action != null) { return PluginImpl.DISPLAY_NAME; } } return null; } public String getUrlName() { for (AbstractBuild&lt;!-- raw HTML omitted --&gt; build = getProject().getLastBuild(); build != null; build = build.getPreviousBuild()) { final AbstractBuildReport action = build.getAction(getBuildActionClass()); if (action != null) { return PluginImpl.URL; } } return null; } public String getSearchUrl() { return PluginImpl.URL; } public boolean isGraphActive() { return false; } public Collection&lt;!-- raw HTML omitted --&gt; getResults() { for (AbstractBuild&lt;!-- raw HTML omitted --&gt; build = getProject().getLastBuild(); build != null; build = build.getPreviousBuild()) { final AbstractBuildReport action = build.getAction(getBuildActionClass()); if (action != null) { return action.getResults(); } } return Collections.emptySet(); } public Statistic getTotals() { for (AbstractBuild&lt;!-- raw HTML omitted --&gt; build = getProject().getLastBuild(); build != null; build = build.getPreviousBuild()) { final AbstractBuildReport action = build.getAction(getBuildActionClass()); if (action != null) { return action.getTotals(); } } return null; } protected abstract Class&lt;!-- raw HTML omitted --&gt;&amp;gt; implements AggregatableAction { public JavaNCSSBuildIndividualReport(Collection&lt;!-- raw HTML omitted --&gt; results) { super(results); } @Override public synchronized void setBuild(AbstractBuild&lt;!-- raw HTML omitted --&gt; build) { super.setBuild(build); if (this.getBuild() != null) { for (Statistic r : getResults()) { r.setOwner(this.getBuild()); } } } public MavenAggregatedReport createAggregatedAction(MavenModuleSetBuild build, Map&amp;lt;MavenModule, List&lt;!-- raw HTML omitted --&gt;&amp;gt; moduleBuilds) { return new JavaNCSSBuildAggregatedReport(build, moduleBuilds); }}That was fairly painless&amp;hellip; Note that we interfaces for both the freestyle and maven2 project types, this is OK as the freestyle projects will ignore the Maven2 stuff and vice-versa while the common code is shared by both. Next we need the aggregated build report:package hudson.plugins.javancss;import hudson.maven.*;import hudson.model.Action;import hudson.plugins.javancss.parser.Statistic;import java.util.ArrayList;import java.util.Collection;import java.util.List;import java.util.Map;public class JavaNCSSBuildAggregatedReport extends AbstractBuildReport&lt;!-- raw HTML omitted --&gt; implements MavenAggregatedReport { public JavaNCSSBuildAggregatedReport(MavenModuleSetBuild build, Map&amp;lt;MavenModule, List&lt;!-- raw HTML omitted --&gt;&amp;gt; moduleBuilds) { super(new ArrayList&lt;!-- raw HTML omitted --&gt;()); setBuild(build); } public synchronized void update(Map&amp;lt;MavenModule, List&lt;!-- raw HTML omitted --&gt;&amp;gt; moduleBuilds, MavenBuild newBuild) { JavaNCSSBuildIndividualReport report = newBuild.getAction(JavaNCSSBuildIndividualReport.class); if (report != null) { Collection&lt;!-- raw HTML omitted --&gt; u = Statistic.merge(report.getResults(), getResults()); getResults().clear(); getResults().addAll(u); getTotals().add(report.getTotals()); } } public Class&lt;!-- raw HTML omitted --&gt;&amp;gt; implements ProminentProjectAction { public JavaNCSSProjectIndividualReport(AbstractProject&lt;!-- raw HTML omitted --&gt; project) { super(project); } protected Class&amp;lt;? extends AbstractBuildReport&amp;gt; getBuildActionClass() { return JavaNCSSBuildIndividualReport.class; }}Don&amp;rsquo;t repeat ourselves comes in handy here as essentially all the work has been done for us!. The project aggregated report:package hudson.plugins.javancss;import hudson.model.Actionable;import hudson.model.ProminentProjectAction;import hudson.model.AbstractBuild;import hudson.model.Action;import hudson.maven.MavenModuleSet;import hudson.maven.MavenModuleSetBuild;import hudson.plugins.javancss.parser.Statistic;public class JavaNCSSProjectAggregatedReport extends AbstractProjectReport&lt;!-- raw HTML omitted --&gt; implements ProminentProjectAction { public JavaNCSSProjectAggregatedReport(MavenModuleSet project) { super(project); } protected Class&amp;lt;? extends AbstractBuildReport&amp;gt; getBuildActionClass() { return JavaNCSSBuildAggregatedReport.class; }}Again DRY to the rescue&amp;hellip; At this point all that remains is to present the reports from these backing objects&amp;hellip; so on with the jelly views. The helper classes and our inheritance makes this easy&amp;hellip; all we need is two jelly files: hudson/plugins/javancss/AbstractBuildReport/reportDetail.jelly and hudson/plugins/javancss/AbstractProjectReport/reportDetail.jelly. Here they are:&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;rdquo; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;Results&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;Package&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;Classes&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;Functions&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;Javadocs&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;NCSS&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;JLC&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;SLCLC&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;MLCLC&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;Totals&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${it.totals.classes}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${it.totals.functions}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${it.totals.javadocs}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${it.totals.ncss}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${it.totals.javadocLines}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${it.totals.singleCommentLines}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${it.totals.multiCommentLines}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;j:forEach var=&amp;ldquo;r&amp;rdquo; items=&amp;quot;${it.results}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.name}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.classes}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.functions}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.javadocs}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.ncss}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.javadocLines}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.singleCommentLines}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;${r.multiCommentLines}&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;/j:forEach&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&amp;lt;/j:jelly&amp;gt;Yep, the two files are identical! Other plugins may not be quite so lucky&amp;hellip; but in general the project level report should be the same as the report for the latest buildMaking a pluginNow we are ready to make our plugin&amp;hellip;. for this we need a class that extends hudson.Plugin and registers our publisher&amp;rsquo;s descriptors with the appropriate lists&amp;hellip; here it is:package hudson.plugins.javancss;import hudson.Plugin;import hudson.maven.MavenReporters;import hudson.tasks.BuildStep;public class PluginImpl extends Plugin { public void start() throws Exception { BuildStep.PUBLISHERS.add(JavaNCSSPublisher.DESCRIPTOR); MavenReporters.LIST.add(JavaNCSSMavenPublisher.DESCRIPTOR); } public static String DISPLAY_NAME = &amp;ldquo;Java NCSS Report&amp;rdquo;; public static String GRAPH_NAME = &amp;ldquo;Java NCSS Trend&amp;rdquo;; public static String URL = &amp;ldquo;javancss&amp;rdquo;; public static String ICON_FILE_NAME = &amp;ldquo;graph.gif&amp;rdquo;;}And that&amp;rsquo;s pretty much it&amp;hellip; we should have a working pluginFinishing touchesOK, so the plugin does not have health reports (i.e. the weather icons) and it does not show a trend graph&amp;hellip; I think I&amp;rsquo;m going to need a part 8 :-(&lt;/p&gt;</description></item><item><title>More praise for Hudson</title><link>https://stephenc.github.io/post/2008-04-01-more-praise-for-hudson/</link><pubDate>Tue, 01 Apr 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-04-01-more-praise-for-hudson/</guid><description>&lt;p&gt;Over on the Maven2 Users list a recent poster asked what CI server was best, and Hudson was the only answer.Then Jason van Zyl posted this praise for Hudson:I know from my vantage point Hudson is the only system I will provide commercial support for at Sonatype because the battle is over. Hudson won by making developers lives&amp;rsquo; easier. Kohsuke will go to no end to make things easier for users. &amp;hellip;At any rate I guarantee you that inside 3 months Hudson will have the best Maven integration of any CI/Build Server there is.I&amp;rsquo;m personally biased towards Hudson, but I have to agree that it has won the war of the CI servers. I don&amp;rsquo;t see anything coming close in ease of use or speed of startup.&lt;/p&gt;</description></item><item><title>Writing a Hudson plugin (Part 6 - Parsing the results)</title><link>https://stephenc.github.io/post/2008-04-01-writing-a-hudson-plugin-part-6-parsing-the-results/</link><pubDate>Tue, 01 Apr 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-04-01-writing-a-hudson-plugin-part-6-parsing-the-results/</guid><description>&lt;p&gt;In some ways parsing the JavaNCSS results is the least interesting part of developing a Hudson plugin, as once I have implemented the parser, it is available for everyone. For that reason I will focus more on:best practice techniques for parsing resultscommon gotchasdesigning for extensionGetting startedFirst off, we need to analyse the results file format. In the case of JavaNCSS there are multiple ways that the results file can be generated: from the JavaNCSS program directly, from ANT or from Maven. This leads us onto gotcha #1Gotcha #1:Never assume that a build tool generates the same format of output when run from the command line, ANT or Maven.A case in point for Gotcha #1 is Findbugs which generates one XML format from the command line and ANT, and generates a different format that appears similar at first glance when run from Maven (mail thread). In this case it turns out that Maven 1 used the different format output, and it is feared that some people came to depend on this Maven 1 format, so when the plugin for Maven 2 was developed, they kept the Maven 1 format. In any case, the moral is don’t assume, check!So we use the sample projects from Part 1 and generate an ANT and a Maven 2 XML report. First off, here is the report from ANT:&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;2008-04-12&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;11:22:30&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.common&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;3&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;10&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;3&lt;!-- raw HTML omitted --&gt; &amp;lt;javadoc_lines&amp;gt;12&amp;lt;/javadoc_lines&amp;gt; &amp;lt;single_comment_lines&amp;gt;0&amp;lt;/single_comment_lines&amp;gt; &amp;lt;multi_comment_lines&amp;gt;0&amp;lt;/multi_comment_lines&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;5&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;8&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;46&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;9&lt;!-- raw HTML omitted --&gt; &amp;lt;javadoc_lines&amp;gt;37&amp;lt;/javadoc_lines&amp;gt; &amp;lt;single_comment_lines&amp;gt;0&amp;lt;/single_comment_lines&amp;gt; &amp;lt;multi_comment_lines&amp;gt;0&amp;lt;/multi_comment_lines&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Packages&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Classes&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Functions&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;NCSS&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Javadocs&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;per&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;4.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;5.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;8.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;46.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;9.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Project&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1.25&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;2.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;11.50&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;2.25&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Package&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1.60&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;9.20&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1.80&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Class&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;5.75&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1.13&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Function&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.common.Factory&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;7&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;3&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;3&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;6.60&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1.60&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;0.00&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1.80&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;46.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.common.Factory.Factory()&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt;46.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;OK, first off, for those following the tutorial exactly, I have cheated a little. I added some more source files into the project to make sure that I have multiple classes is different packages. You can see the source code I built from here. Additionally, I have trimmed the output somewhat to highlight the interesting bits, removing the duplicate entries.From this report file we can see a basic XML structure:The root element is &lt;!-- raw HTML omitted --&gt; and has child elements: &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, and &lt;!-- raw HTML omitted --&gt;The &lt;!-- raw HTML omitted --&gt; and &lt;!-- raw HTML omitted --&gt; elements are the timestamp when the report was generated with the date in YYYY-MM-DD format and the time in HH:MM:SS formatThe &lt;!-- raw HTML omitted --&gt; element has child elements: &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, and &lt;!-- raw HTML omitted --&gt;. There are multiple &lt;!-- raw HTML omitted --&gt;; elements, but only one &lt;!-- raw HTML omitted --&gt; and &lt;!-- raw HTML omitted --&gt; element.The &lt;!-- raw HTML omitted --&gt; elements have child elements: &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &amp;lt;javadoc_lines&amp;gt;, &amp;lt;single_comment_lines&amp;gt; and &amp;lt;multi_comment_lines&amp;gt;. The &lt;!-- raw HTML omitted --&gt; element contains the name of the package as a String and the other elements contain totals as Integers.The &lt;!-- raw HTML omitted --&gt; element has child elements: &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt;, &amp;lt;javadoc_lines&amp;gt;, &amp;lt;single_comment_lines&amp;gt; and &amp;lt;multi_comment_lines&amp;gt;. These elements are the sum of all the corresponding &lt;!-- raw HTML omitted --&gt; children inside the &lt;!-- raw HTML omitted --&gt; parentThe &lt;!-- raw HTML omitted --&gt; element seems to be a HTML table.The &lt;!-- raw HTML omitted --&gt; element has child elements: &lt;!-- raw HTML omitted --&gt;, &lt;!-- raw HTML omitted --&gt; and &lt;!-- raw HTML omitted --&gt;. There are multiple &lt;!-- raw HTML omitted --&gt; elements, the &lt;!-- raw HTML omitted --&gt; element contains the average results for all the &lt;!-- raw HTML omitted --&gt; elements and the &lt;!-- raw HTML omitted --&gt; element providing some form of total or average.The &lt;!-- raw HTML omitted --&gt; element has child elements: &lt;!-- raw HTML omitted --&gt; and &lt;!-- raw HTML omitted --&gt;. Again there are multiple &lt;!-- raw HTML omitted --&gt; elements with the &lt;!-- raw HTML omitted --&gt; element providing some form of total or average (interestingly the result appears to be the same as from &lt;!-- raw HTML omitted --&gt;).Now, let’s take a look at what Maven 2 gives us:&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;2008-04-12&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;11:43:06&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.common&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;3&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;10&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;3&lt;!-- raw HTML omitted --&gt; &amp;lt;javadoc_lines&amp;gt;12&amp;lt;/javadoc_lines&amp;gt; &amp;lt;single_comment_lines&amp;gt;0&amp;lt;/single_comment_lines&amp;gt; &amp;lt;multi_comment_lines&amp;gt;0&amp;lt;/multi_comment_lines&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;5&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;8&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;46&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;10&lt;!-- raw HTML omitted --&gt; &amp;lt;javadoc_lines&amp;gt;42&amp;lt;/javadoc_lines&amp;gt; &amp;lt;single_comment_lines&amp;gt;3&amp;lt;/single_comment_lines&amp;gt; &amp;lt;multi_comment_lines&amp;gt;3&amp;lt;/multi_comment_lines&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Packages&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Classes&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Functions&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;NCSS&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Java &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;4.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;5.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;8.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;46.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;10.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;P &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1.25&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;2.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;11.50&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;2.50&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Packag &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1.60&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;9.20&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;2.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Class&lt;!-- raw HTML omitted --&gt;&amp;lt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;5.75&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;1.25&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Function&lt;!-- raw HTML omitted --&gt;&amp;lt;/ &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.common.api.Namer&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;2&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;6.60&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1.60&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;0.00&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;2.00&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;46.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.common.api.Namer.newName()&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;hellip; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;46.00&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Thankfully, this is the same format as for ANT. You will also be relieved to know that this is the format generated by the JavaNCSS program directly. Thus we only have to write one parser, and we do not have to detect what format we are parsing. But before I forget:Best Practice #1:When there are multiple formats of a report generated by different tools, make sure that your Hudson plugin can detect the different formats and can handle them appropriately (by either delegating to a different parser implementation, or by handling the differences on the fly).One of the goals of Hudson is to minimise configuration. So when a plugin can detect an configuration option automatically, it should detect it automatically (possibly providing an “Advanced” option button to let users override the detection if Hudson gets it wrong)Start smallLooking at the JavaNCSS output, I see that there is a lot of information&amp;hellip; and I only have one more Part left in this series! So I am not going to parse everything. I am sure that in the future I will extend the Hudson plugin to parse all of the file, but for now I am just going to concentrate on the &lt;!-- raw HTML omitted --&gt; element. This gives users something useful and it’s better than nothing.But what happens when I do get around to parsing the &lt;!-- raw HTML omitted --&gt; and &lt;!-- raw HTML omitted --&gt; elements? People may have lots of old builds and they will want to see the trends of the &lt;!-- raw HTML omitted --&gt; and &lt;!-- raw HTML omitted --&gt; results. I have two choices:Tell them “Sorry, out of luck”Save the results with the build, and then the newer parser can extract the results when people want the trend.Choosing between these two options can be difficult. My preference is to go with option two, as long as the results are not a really big file.Best Practice #2:If you are not parsing everything in the results file, and the results file is not too big, and it can be parsed without reference to the source code, copy the results file to Hudson so that future versions of your plugin can read the information you are not currently parsing.Don’t over parseThe results that we parse are going to be placed into an Action object. This Action object will be serialized. When Hudson starts up, it reads all the results of all the builds. If we place too much information in our Action object, this can have a detrimental effect on Hudson’s performance. When users have 50+ projects each with a couple of hundred builds, they will thank you for keeping your Action objects small.Gotcha #2:Don’t store too much in your Action objects.Don’t under parseOK, so I have just given out about storing too much in your Action objects. There is a second problem&amp;hellip; not storing enough! Most reporting plugins try to present a trend graph to show progress over a number of builds. If we don’t store the information required to generate this trend graph inside our Action objects, then displaying the trend graph will require parsing all the result files for all builds of a project. This can have a detrimental effect on Hudson’s performance. When users have projects with a couple of hundred builds, they will thank you for keeping the information to generate the main trend graph inside your Action objects.Gotcha #3:Store the information for generating the Project level trend graph in your Action objects.A case in point for Gotach #3 is the cobertura plugin, which at the time of writing, does not store the information for the main trend graph in the Action object. I fully intend to fix this situation once I have finished this series!How to parseMost of the result files that you will encounter are XML based. We are writing our plugins in Java, so that gives us a range of parsers to choose from, e.g.SAXDOMStAXRoll your ownEtc.Given that report files can end up very big for very big projects, we need to be careful how we parse the results:Gotcha #4:Don’t parse XML results using DOM, as this will require reading the entire report file into memory.I am going to stick my neck out and make a recommendation:Best Practice #3:Use an XML pull parser to parse XML report files.They are generally faster, use less memory, and are better suited to a “hit-and-run” style of result extraction.Be able to aggregate parsing resultsYou may think that there will only ever be one result file that you need to parse. Maven 2 usually throws a spanner into that model, and everyone has their own ANT build script, so:Gotcha #5:Don’t assume you only have to parse one report file for each project.This gotcha arrives from the code coverage plugins (emma, clover, cobertura). Initially, you would think that people are only interested in one code coverage result, i.e. the coverage for the project&amp;hellip; so they will only have one result file that we need to parse, right? Wrong! Some tools/build scripts generate a report for each module but only generate a summary report in non-conforming HTML. Some tools / build scripts generate a report for unit tests and integration tests separately. It’s a mess, and don’t get me started on using different tools for different test types&amp;hellip;The parsing engineOk, so here is the parsing engine:package hudson.plugins.javancss.parser;import hudson.model.AbstractBuild;import hudson.util.IOException2;import org.xmlpull.v1.XmlPullParser;import org.xmlpull.v1.XmlPullParserException;import org.xmlpull.v1.XmlPullParserFactory;import java.io.&lt;em&gt;;import java.util.&lt;/em&gt;;public class Statistic implements Serializable { private AbstractBuild&lt;!-- raw HTML omitted --&gt; owner; private String name; private long classes; private long functions; private long ncss; private long javadocs; private long javadocLines; private long singleCommentLines; private long multiCommentLines; public static Collection&lt;!-- raw HTML omitted --&gt; parse(File inFile) throws IOException, XmlPullParserException { Collection&lt;!-- raw HTML omitted --&gt; results = new ArrayList&lt;!-- raw HTML omitted --&gt;(); FileInputStream fis = null; BufferedInputStream bis = null; try { fis = new FileInputStream(inFile); bis = new BufferedInputStream(fis); XmlPullParserFactory factory = XmlPullParserFactory.newInstance(); factory.setNamespaceAware(true); factory.setValidating(false); XmlPullParser parser = factory.newPullParser(); parser.setInput(bis, null); // check that the first tag is &lt;!-- raw HTML omitted --&gt; expectNextTag(parser, &amp;ldquo;javancss&amp;rdquo;); // skip until we get to the &lt;!-- raw HTML omitted --&gt; tag while (parser.getDepth() &amp;gt; 0 &amp;amp;&amp;amp; (parser.getEventType() != XmlPullParser.START_TAG || !&amp;ldquo;packages&amp;rdquo;.equals(parser.getName()))) { parser.next(); } while (parser.getDepth() &amp;gt; 0 &amp;amp;&amp;amp; (parser.getEventType() != XmlPullParser.START_TAG || !&amp;ldquo;package&amp;rdquo;.equals(parser.getName()))) { parser.next(); } while (parser.getDepth() &amp;gt;= 2 &amp;amp;&amp;amp; parser.getEventType() == XmlPullParser.START_TAG &amp;amp;&amp;amp; &amp;ldquo;package&amp;rdquo;.equals(parser.getName())) { Map&amp;lt;String, String&amp;gt; data = new HashMap&amp;lt;String, String&amp;gt;(); String lastTag = null; String lastText = null; int depth = parser.getDepth(); while (parser.getDepth() &amp;gt;= depth) { parser.next(); switch (parser.getEventType()) { case XmlPullParser.START_TAG: lastTag = parser.getName(); break; case XmlPullParser.TEXT: lastText = parser.getText(); break; case XmlPullParser.END_TAG: if (parser.getDepth() == 4 &amp;amp;&amp;amp; lastTag != null &amp;amp;&amp;amp; lastText != null) { data.put(lastTag, lastText); } lastTag = null; lastText = null; break; } } if (data.containsKey(&amp;ldquo;name&amp;rdquo;)) { Statistic s = new Statistic(data.get(&amp;ldquo;name&amp;rdquo;)); s.setClasses(Long.valueOf(data.get(&amp;ldquo;classes&amp;rdquo;))); s.setFunctions(Long.valueOf(data.get(&amp;ldquo;functions&amp;rdquo;))); s.setNcss(Long.valueOf(data.get(&amp;ldquo;ncss&amp;rdquo;))); s.setJavadocs(Long.valueOf(data.get(&amp;ldquo;javadocs&amp;rdquo;))); s.setJavadocLines(Long.valueOf(data.get(&amp;ldquo;javadoc_lines&amp;rdquo;))); s.setSingleCommentLines(Long.valueOf(data.get(&amp;ldquo;single_comment_lines&amp;rdquo;))); s.setMultiCommentLines(Long.valueOf(data.get(&amp;ldquo;multi_comment_lines&amp;rdquo;))); results.add(s); } parser.next(); } } catch (XmlPullParserException e) { throw new IOException2(e); } finally { if (bis != null) { bis.close(); } if (fis != null) { fis.close(); } } return results; } private static void skipTag(XmlPullParser parser) throws IOException, XmlPullParserException { parser.next(); endElement(parser); } private static void expectNextTag(XmlPullParser parser, String tag) throws IOException, XmlPullParserException { while (true) { if (parser.getEventType() != XmlPullParser.START_TAG) { parser.next(); continue; } if (parser.getName().equals(tag)) { return; } throw new IOException(&amp;ldquo;Expecting tag &amp;quot; + tag); } } private static void endElement(XmlPullParser parser) throws IOException, XmlPullParserException { int depth = parser.getDepth(); while (parser.getDepth() &amp;gt;= depth) { parser.next(); } } public Statistic(String name) { this.name = name; } &amp;hellip; // Simple getters and setters for all the private fields &amp;hellip; // equals based on all private fields, hashCode based on // name and owner. &amp;hellip; // toString &amp;hellip;}Essentially the main work is done in the static parse method. It takes a File and tries to parse it. We get an XML Pull Parser for the stream and ensure that it is neither namespace aware nor validating as the file format does not use namespaces and we will be forgiving on the XML format.The first tag should be &lt;!-- raw HTML omitted --&gt; and after that we skip until we get a &lt;!-- raw HTML omitted --&gt; tag. Once we have found the &lt;!-- raw HTML omitted --&gt; tag we skip until we hit the first &lt;!-- raw HTML omitted --&gt; tag.We are reverse engineering the JavaNCSS file format, so we will not make any assumptions about the order of the child elements in the &lt;!-- raw HTML omitted --&gt; element. We put all the child elements into a Map keyed by the element name, and then when we reach the end of the &lt;!-- raw HTML omitted --&gt; element we pull out the information we were after from the Map and put it into a Statistic object and add that to the collection of results that we will return.As soon as we hit the end of the &lt;!-- raw HTML omitted --&gt; element, we stop parsing.Supporting aggregationIn order to support aggregation of multiple results, we&amp;rsquo;ll add some utility methods to the Statistic class, first we need methods that allow us to calculate totals:package hudson.plugins.javancss.parser;&amp;hellip;public class Statistic implements Serializable { &amp;hellip; public static Statistic total(Collection&lt;!-- raw HTML omitted --&gt;&amp;hellip; results) { Collection&lt;!-- raw HTML omitted --&gt; merged = merge(results); Statistic total = new Statistic(&amp;rdquo;&amp;quot;); for (Statistic individual : merged) { total.add(individual); } return total; } public void add(Statistic r) { classes += r.classes; functions += r.functions; ncss += r.ncss; javadocs += r.javadocs; javadocLines += r.javadocLines; singleCommentLines += r.singleCommentLines; multiCommentLines += r.multiCommentLines; } &amp;hellip;}The total method just calculates the total of all the statistics in a collection of statistics. We will also need to be able to merge different result sets. This should aggregate totals for each package separately and return a collection with one total statistic for each package:package hudson.plugins.javancss.parser;&amp;hellip;public class Statistic implements Serializable { &amp;hellip; public static Collection&lt;!-- raw HTML omitted --&gt; merge( Collection&lt;!-- raw HTML omitted --&gt;&amp;hellip; results) { if (results.length == 0) { return Collections.emptySet(); } else if (results.length == 1) { return results[0]; } else { Map&amp;lt;String, Statistic&amp;gt; merged = new HashMap&amp;lt;String, Statistic&amp;gt;(); for (Collection&lt;!-- raw HTML omitted --&gt; result : results) { for (Statistic individual : result) { if (!merged.containsKey(individual.name)) { merged.put(individual.name, new Statistic(individual.name)); } merged.get(individual.name).add(individual); } } return merged.values(); } } &amp;hellip;}That is pretty much it for the parser engine.The GhostwriterNow we need to hook the engine into our publisher. We will need to configure the UI elements and the Actions&amp;hellip; all tasks for the final part, but for now, we&amp;rsquo;ll just hook it up. We want to run the parsing on the slave side so we implement Ghostwriter.SlaveGhostwriter.package hudson.plugins.javancss;import hudson.FilePath;import hudson.model.AbstractBuild;import hudson.model.BuildListener;import hudson.plugins.helpers.BuildProxy;import hudson.plugins.helpers.Ghostwriter;import hudson.plugins.javancss.parser.Statistic;import org.xmlpull.v1.XmlPullParserException;import java.io.File;import java.io.IOException;import java.util.Collection;import java.util.HashSet;import java.util.Set;public class JavaNCSSGhostwriter implements Ghostwriter, Ghostwriter.SlaveGhostwriter { private final String reportFilenamePattern; public JavaNCSSGhostwriter(String reportFilenamePattern) { this.reportFilenamePattern = reportFilenamePattern; } public boolean performFromSlave( BuildProxy build, BuildListener listener) throws InterruptedException, IOException { FilePath[] paths = build.getExecutionRootDir() .list(reportFilenamePattern); Collection&lt;!-- raw HTML omitted --&gt; results = null; Set&lt;!-- raw HTML omitted --&gt; parsedFiles = new HashSet&lt;!-- raw HTML omitted --&gt;(); for (FilePath path : paths) { final String pathStr = path.getRemote(); if (!parsedFiles.contains(pathStr)) { parsedFiles.add(pathStr); try { Collection&lt;!-- raw HTML omitted --&gt; result = Statistic.parse(new File(pathStr)); if (results == null) { results = result; } else { results = Statistic.merge(results, result); } // TODO copy the parsed file to the master } catch (XmlPullParserException e) { e.printStackTrace(listener.getLogger()); } } } // TODO add the results into an Action an attach it to the // build. return true; }}Basically, we search the supplied wildcard-path for report files and merge all the results together into a collection of results. In the final part of this series we will create our Action to hold the results and wire everything together.&lt;/p&gt;</description></item><item><title>Writing a Hudson plugin (Part 5½ - Typos corrected)</title><link>https://stephenc.github.io/post/2008-03-01-writing-a-hudson-plugin-part-5-typos-corrected/</link><pubDate>Sat, 01 Mar 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-03-01-writing-a-hudson-plugin-part-5-typos-corrected/</guid><description>&lt;p&gt;Ok, life has got in the way and I have not been able to update this series as quickly as I originally intended. In any case, there were a number of bugs in Hudson that I discovered and are now fixed, and there was a good deal of tidy-up needed in order for me to figure out what to do for parts 6 and 7. The good news is that I am getting closer to finishing writing these final two parts. The bad news is that there are a number of corrections to the previous posts (I have put some corrections in-line for parts 4 and 5). This post aims to ensure that, for parts 6 and 7, everyone is able to follow from the same code!pom.xmlThis needs to be updated to reference a Hudson version of at least 1.200 in order to have the bugs I identified fixed.src/main/java/hudson/plugins/helpers/AbstractBuildAction.javaAFAIK I escaped all the HTML entities and this file is the same as constructed from the previous posts.package hudson.plugins.helpers;import hudson.model.AbstractBuild;import hudson.model.HealthReportingAction;public abstract class AbstractBuildAction&amp;lt;BUILD extends AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;gt; implements HealthReportingAction { private BUILD build = null; protected AbstractBuildAction() { } public synchronized BUILD getBuild() { return build; } public synchronized void setBuild(BUILD build) { if (this.build == null &amp;amp;&amp;amp; this.build != build) { this.build = build; } } public boolean isFloatingBoxActive() { return false; } public boolean isGraphActive() { return false; } public String getGraphName() { return getDisplayName(); } public String getSummary() { return &amp;ldquo;&amp;rdquo;; }}src/main/java/hudson/plugins/helpers/AbstractMavenReporterImpl.javaAFAIK I escaped all the HTML entities and this file is the same as constructed from the previous posts.package hudson.plugins.helpers;import hudson.maven.MavenBuildProxy;import hudson.maven.MavenReporter;import hudson.maven.MojoInfo;import hudson.model.BuildListener;import hudson.model.Result;import org.apache.maven.project.MavenProject;import java.io.IOException;public abstract class AbstractMavenReporterImpl extends MavenReporter { protected MojoExecutionReportingMode getExecutionMode() { return MojoExecutionReportingMode.ONLY_REPORT_ON_SUCCESS; } public boolean postExecute(MavenBuildProxy build, MavenProject pom, MojoInfo mojo, BuildListener listener, Throwable error) throws InterruptedException, IOException { if (!isExecutingMojo(mojo)) { // not a mojo who&amp;rsquo;s result we are interested in return true; } final Boolean okToContinue = getExecutionMode().isOkToContinue(this, build, listener, error); if (okToContinue != null) { return okToContinue; } build.registerAsProjectAction(this); return BuildProxy.doPerform(newGhostwriter(pom, mojo), build, pom, listener); } protected abstract boolean isExecutingMojo(MojoInfo mojo); protected abstract Ghostwriter newGhostwriter(MavenProject pom, MojoInfo mojo); public boolean preExecute(MavenBuildProxy build, MavenProject pom, MojoInfo mojo, BuildListener listener) throws InterruptedException, IOException { return !isAutoconfMojo(mojo) || autoconfPom(build, pom, mojo, listener); } protected boolean autoconfPom(MavenBuildProxy build, MavenProject pom, MojoInfo mojo, BuildListener listener) { return true; } protected boolean isAutoconfMojo(MojoInfo mojo) { return false; } protected enum MojoExecutionReportingMode { ONLY_REPORT_ON_SUCCESS { Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error) { return error == null ? null : Boolean.TRUE; } }, ALWAYS_REPORT_STABLE { Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error) { return null; }}, REPORT_UNSTABLE_ON_ERROR { Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error) { if (error != null) { listener.getLogger().println(&amp;quot;[HUDSON] &amp;quot; + reporter.getDescriptor().getDisplayName() + &amp;quot; setting build to UNSTABLE&amp;quot;); build.setResult(Result.UNSTABLE); } return null; } }; abstract Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error); }}src/main/java/hudson/plugins/helpers/AbstractProjectAction.javaAFAIK I escaped all the HTML entities and this file is the same as constructed from the previous posts.package hudson.plugins.helpers;import hudson.model.AbstractProject;import hudson.model.Actionable;abstract public class AbstractProjectAction&amp;lt;PROJECT extends AbstractProject&lt;!-- raw HTML omitted --&gt;&amp;gt; extends Actionable { private final PROJECT project; protected AbstractProjectAction(PROJECT project) { this.project = project; } public PROJECT getProject() { return project; } public boolean isFloatingBoxActive() { return true; } public boolean isGraphActive() { return false; } public String getGraphName() { return getDisplayName(); }}src/main/java/hudson/plugins/helpers/AbstractPublisherImpl.javaSome of the HTML entities were not properly escaped.package hudson.plugins.helpers;import hudson.tasks.Publisher;import hudson.model.AbstractBuild;import hudson.model.BuildListener;import hudson.Launcher;import java.io.IOException;public abstract class AbstractPublisherImpl extends Publisher { protected abstract Ghostwriter newGhostwriter(); public boolean perform(AbstractBuild&lt;!-- raw HTML omitted --&gt; build, Launcher launcher, final BuildListener listener) throws InterruptedException, IOException { return BuildProxy.doPerform(newGhostwriter(), build, listener); } public boolean prebuild(AbstractBuild&lt;!-- raw HTML omitted --&gt; build, BuildListener listener) { return true; }}src/main/java/hudson/plugins/helpers/BuildProxy.javaAgain, some of the HTML entities were not properly escaped. Additionally, this is the file that has had the most updates during this tutorial, so here it is in full:package hudson.plugins.helpers;import hudson.FilePath;import hudson.maven.MavenBuildProxy;import hudson.util.IOException2;import hudson.model.Action;import hudson.model.Result;import hudson.model.AbstractBuild;import hudson.model.BuildListener;import java.util.Calendar;import java.util.List;import java.util.ArrayList;import java.io.IOException;import java.io.Serializable;import org.apache.maven.project.MavenProject;public final class BuildProxy implements Serializable { private final FilePath artifactsDir; private final FilePath projectRootDir; private final FilePath buildRootDir; private final FilePath executionRootDir; private final Calendar timestamp; private final List&amp;lt;AbstractBuildAction&amp;lt;AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;raquo; actions = new ArrayList&amp;lt;AbstractBuildAction&amp;lt;AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;raquo;(); private Result result = null; private boolean continueBuild = true; public static boolean doPerform(Ghostwriter ghostwriter, AbstractBuild&lt;!-- raw HTML omitted --&gt; build, BuildListener listener) throws IOException, InterruptedException { // first, do we need to do anything on the slave if (ghostwriter instanceof Ghostwriter.SlaveGhostwriter) { // construct the BuildProxy instance that we will use BuildProxy buildProxy = new BuildProxy( new FilePath(build.getArtifactsDir()), new FilePath(build.getProject().getRootDir()), new FilePath(build.getRootDir()), build.getProject().getModuleRoot(), build.getTimestamp()); BuildProxyCallableHelper callableHelper = new BuildProxyCallableHelper( buildProxy, ghostwriter, listener); try { buildProxy = buildProxy.getExecutionRootDir().act(callableHelper); buildProxy.updateBuild(build); // terminate the build if necessary if (!buildProxy.isContinueBuild()) { return false; } } catch (Exception e) { throw unwrapException(e, listener); } } // finally, on to the master final Ghostwriter.MasterGhostwriter masterGhostwriter = Ghostwriter.MasterGhostwriter.class.cast(ghostwriter); return masterGhostwriter == null || masterGhostwriter.performFromMaster(build, build.getProject().getModuleRoot(), listener); } private static RuntimeException unwrapException(Exception e, BuildListener listener) throws IOException, InterruptedException { if (e.getCause() instanceof IOException) { throw new IOException2(e.getCause().getMessage(), e); } if (e.getCause() instanceof InterruptedException) { e.getCause().printStackTrace(listener.getLogger()); throw new InterruptedException(e.getCause().getMessage()); } if (e.getCause() instanceof RuntimeException) { throw new RuntimeException(e.getCause()); } // How on earth do we get this far down the branch e.printStackTrace(listener.getLogger()); throw new RuntimeException(&amp;ldquo;Unexpected exception&amp;rdquo;, e); } public void updateBuild(AbstractBuild&lt;!-- raw HTML omitted --&gt; build) { for (AbstractBuildAction&amp;lt;AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;gt; action : actions) { if (!build.getActions().contains(action)) { action.setBuild(build); build.getActions().add(action); } } if (result != null &amp;amp;&amp;amp; result.isWorseThan(build.getResult())) { build.setResult(result); } } public static boolean doPerform(Ghostwriter ghostwriter, MavenBuildProxy mavenBuildProxy, MavenProject pom, final BuildListener listener) throws InterruptedException, IOException { // first, construct the BuildProxy instance that we will use BuildProxy buildProxy = new BuildProxy( mavenBuildProxy.getArtifactsDir(), mavenBuildProxy.getProjectRootDir(), mavenBuildProxy.getRootDir(), new FilePath(pom.getBasedir()), mavenBuildProxy.getTimestamp()); // do we need to do anything on the slave if (ghostwriter instanceof Ghostwriter.SlaveGhostwriter) { final Ghostwriter.SlaveGhostwriter slaveGhostwriter = (Ghostwriter.SlaveGhostwriter) ghostwriter; // terminate the build if necessary if (!slaveGhostwriter.performFromSlave(buildProxy, listener)) { return false; } } // finally, on to the master try { return mavenBuildProxy.execute(new BuildProxyCallableHelper( buildProxy, ghostwriter, listener)); } catch (Exception e) { throw unwrapException(e, listener); } } private BuildProxy(FilePath artifactsDir, FilePath projectRootDir, FilePath buildRootDir, FilePath executionRootDir, Calendar timestamp) { this.artifactsDir = artifactsDir; this.projectRootDir = projectRootDir; this.buildRootDir = buildRootDir; this.executionRootDir = executionRootDir; this.timestamp = timestamp; } public List&amp;lt;AbstractBuildAction&amp;lt;AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;raquo; getActions() { return actions; } public FilePath getArtifactsDir() { return artifactsDir; } public FilePath getBuildRootDir() { return buildRootDir; } public FilePath getExecutionRootDir() { return executionRootDir; } public FilePath getProjectRootDir() { return projectRootDir; } public Calendar getTimestamp() { return timestamp; } public Result getResult() { return result; } public void setResult(Result result) { this.result = result; } public boolean isContinueBuild() { return continueBuild; } public void setContinueBuild(boolean continueBuild) { this.continueBuild = continueBuild; }}src/main/java/hudson/plugins/helpers/BuildProxyCallableHelper.javaLost some HTML entities (again!)package hudson.plugins.helpers;import hudson.remoting.Callable;import hudson.maven.MavenBuildProxy;import hudson.maven.MavenBuild;import hudson.model.BuildListener;import java.io.IOException;class BuildProxyCallableHelper implements Callable&amp;lt;BuildProxy, Exception&amp;gt;, MavenBuildProxy.BuildCallable&amp;lt;Boolean, Exception&amp;gt; { private final BuildProxy buildProxy; private final Ghostwriter ghostwriter; private final BuildListener listener; BuildProxyCallableHelper(BuildProxy buildProxy, Ghostwriter ghostwriter, BuildListener listener) { this.buildProxy = buildProxy; this.ghostwriter = ghostwriter; this.listener = listener; } public Boolean call(MavenBuild mavenBuild) throws Exception { buildProxy.updateBuild(mavenBuild); if (ghostwriter instanceof Ghostwriter.MasterGhostwriter) { final Ghostwriter.MasterGhostwriter masterBuildStep = (Ghostwriter.MasterGhostwriter) ghostwriter; return masterBuildStep.performFromMaster(mavenBuild, buildProxy.getExecutionRootDir(), listener); } return true; } public BuildProxy call() throws Exception { if (ghostwriter instanceof Ghostwriter.SlaveGhostwriter) { final Ghostwriter.SlaveGhostwriter slaveBuildStep = (Ghostwriter.SlaveGhostwriter) ghostwriter; try { buildProxy.setContinueBuild( slaveBuildStep.performFromSlave(buildProxy, listener)); return buildProxy; } catch (IOException e) { throw new Exception(e); } catch (InterruptedException e) { throw new Exception(e); } } return buildProxy; }}src/main/java/hudson/plugins/helpers/Ghostwriter.javaJava Generics are a real gotcha for HTML entitiespackage hudson.plugins.helpers;import hudson.model.BuildListener;import hudson.model.AbstractBuild;import hudson.FilePath;import java.io.Serializable;import java.io.IOException;public interface Ghostwriter extends Serializable { public static interface SlaveGhostwriter extends Ghostwriter { boolean performFromSlave(BuildProxy build, BuildListener listener) throws InterruptedException, IOException; } public static interface MasterGhostwriter extends Ghostwriter { boolean performFromMaster(AbstractBuild&lt;!-- raw HTML omitted --&gt; build, FilePath executionRoot, BuildListener listener) throws InterruptedException, IOException; }}src/main/resources/hudson/plugins/helpers/AbstractBuildAction/enlargedGraph.jellyI left a &amp;ldquo;css&amp;rdquo; attribute in the &amp;lt;l:layout&amp;gt; tag.&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.build}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;largeGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractBuildAction/floatingBox.jellyThe &amp;lt;j:if&amp;gt; should be based on the from variable and not it&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;j:if test=&amp;quot;${from.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; ${from.graphName} &lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;enlarge&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;/j:if&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractBuildAction/index.jellyI left a &amp;ldquo;css&amp;rdquo; attribute in the &amp;lt;l:layout&amp;gt; tag.&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.build}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.displayName}&lt;!-- raw HTML omitted --&gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;st:include page=&amp;ldquo;reportDetail.jelly&amp;rdquo;/&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractBuildAction/largeGraph.jelly, src/main/resources/hudson/plugins/helpers/AbstractBuildAction/normalGraph.jelly, and src/main/resources/hudson/plugins/helpers/AbstractBuildAction/reportDetail.jellyThese are all the same content, and are basically empty placeholders to be overrided in classes that extend AbstractBuildAction. I do not think there are any corrections.&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractBuildAction/summary.jellyThe &amp;lt;j:if&amp;gt; had an extra } in the expression&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot; xmlns:i=&amp;ldquo;jelly:fmt&amp;rdquo;&amp;gt; &amp;lt;t:summary icon=&amp;quot;${it.iconFileName}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.displayName}&lt;!-- raw HTML omitted --&gt; ${it.summary} &amp;lt;/t:summary&amp;gt; &amp;lt;j:if test=&amp;quot;${it.floatingBoxActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;floatingBox.jelly&amp;rdquo;/&amp;gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;/j:if&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractProjectAction/enlargedGraph.jellyI left a &amp;ldquo;css&amp;rdquo; attribute in the &amp;lt;l:layout&amp;gt; tag.&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.project}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;largeGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractProjectAction/floatingBox.jellyThe &amp;lt;j:if&amp;gt; should be based on the from variable and not it&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot; xmlns:i=&amp;ldquo;jelly:fmt&amp;rdquo; xmlns:local=&amp;ldquo;local&amp;rdquo;&amp;gt; &amp;lt;j:if test=&amp;quot;${from.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; ${from.graphName} &lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;enlarge&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;/j:if&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractProjectAction/index.jellyI left a &amp;ldquo;css&amp;rdquo; attribute in the &amp;lt;l:layout&amp;gt; tag.&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.project}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.displayName}&lt;!-- raw HTML omitted --&gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;st:include page=&amp;ldquo;reportDetail.jelly&amp;rdquo;/&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;src/main/resources/hudson/plugins/helpers/AbstractProjectAction/largeGraph.jelly, src/main/resources/hudson/plugins/helpers/AbstractProjectAction/normalGraph.jelly, and src/main/resources/hudson/plugins/helpers/AbstractProjectAction/reportDetail.jellyThese are all the same content, and are basically empty placeholders to be overrided in classes that extend AbstractProjectAction. I do not think there are any corrections.&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;&lt;/p&gt;</description></item><item><title>Writing a Hudson plug-in (Part 4 – Abstract Publishers and MavenReporters)</title><link>https://stephenc.github.io/post/2008-02-01-writing-a-hudson-plug-in-part-4-abstract-publishers-and-mavenreporters/</link><pubDate>Fri, 01 Feb 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-02-01-writing-a-hudson-plug-in-part-4-abstract-publishers-and-mavenreporters/</guid><description>&lt;p&gt;This is the fourth installment, which covers the two abstract classes that call the Ghostwriter for us. When we implement our plugin we will extend from these two classes. These classes perform the work of calling the Ghostwriter at the appropriate points in the build, the concrete classes that we will develop in Part 5, however have the responsibility of creating a configured Ghostwriter and providing it to the superclass for execution.AbstractPublisherImplIn a way, this is the simplest of the two classes:package hudson.plugins.helpers;import hudson.tasks.Publisher;import hudson.model.AbstractBuild;import hudson.model.BuildListener;import hudson.Launcher;import java.io.IOException;public abstract class AbstractPublisherImpl extends Publisher { protected abstract Ghostwriter newGhostwriter(); public boolean perform(AbstractBuild build, Launcher launcher, final BuildListener listener) throws InterruptedException, IOException { return BuildProxy.doPerform(newGhostwriter(), build, listener); } public boolean prebuild(AbstractBuild build, BuildListener listener) { return true; }}Fairly simple, we just ask the BuildProxy to invoke the new Ghostwriter created by the concrete class.AbstractMavenReporterImplThis class needs to do a bit more work. First I&amp;rsquo;ll present the abstract methods and protected methods that can be overrided by implementing classes:package hudson.plugins.helpers;import hudson.maven.MavenReporter;import hudson.maven.MojoInfo;import hudson.maven.MavenBuildProxy;import hudson.model.BuildListener;import hudson.model.Result;import hudson.plugins.helpers.BuildProxy;import hudson.plugins.javancss.PluginImpl;import org.apache.maven.project.MavenProject;import java.io.IOException;public abstract class AbstractMavenReporterImpl extends MavenReporter { protected abstract boolean isExecutingMojo(MojoInfo mojo); protected abstract Ghostwriter newGhostwriter(MavenProject pom, MojoInfo mojo); protected boolean autoconfPom(MavenBuildProxy build, MavenProject pom, MojoInfo mojo, BuildListener listener) { return true; } protected boolean isAutoconfMojo(MojoInfo mojo) { return false; }}Maven project execution consists of invocations of various golas of the different mojos that are bound to the Maven lifecycle. Hudson inserts hooks that allow us to intercept mojos before they execute and after they have executed. Intercepting prior to execution can be useful to ensure that the plugin has been configured with the options we require (e.g. XML output enabled). Post execution is usually when we want to invoke our Ghostwriter. If the implementing class wants to be able to tweak the mojo configuration prior to execution it needs to override isAutoconfMojo in order to identify the mojo executions that need to be tweaked, and override autoconfPom to do the actual configuration.The implementing class needs to provide:a isExecutingMojo method to identify execution of the mojo that this publisher reports on.a newGhostwriter method that constructs the Ghostwriter which will do the work for us. The new Ghostwriter can either be configured manually on the build page, and/or can be configured based on information in the pom.The final thing that we need to decide is when to execute the publisher:package hudson.plugins.helpers;&amp;hellip;public abstract class AbstractMavenReporterImpl extends MavenReporter { &amp;hellip; protected MojoExecutionReportingMode getExecutionMode() { return MojoExecutionReportingMode.ONLY_REPORT_ON_SUCCESS; } &amp;hellip; protected enum MojoExecutionReportingMode { ONLY_REPORT_ON_SUCCESS { Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error) { return error == null ? null : Boolean.TRUE; } }, ALWAYS_REPORT_STABLE { Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error) { return null; }}, REPORT_UNSTABLE_ON_ERROR { Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error) { if (error != null) { listener.getLogger().println(&amp;quot;[HUDSON] &amp;quot; + reporter.getDescriptor().getDisplayName() + &amp;quot; setting build to UNSTABLE&amp;quot;); build.setResult(Result.UNSTABLE); } return null; } }; abstract Boolean isOkToContinue(MavenReporter reporter, MavenBuildProxy build, BuildListener listener, Throwable error); }}We define three different execution modes:ONLY_REPORT_ON_SUCCESS - this ensures that we only run the publisher if the mojo executed without error.ALWAYS_REPORT_STABLE - runs the publisher even if the mojo had an execution error, never marks the build as failed or unstable (note that Maven will most likely mark the build as failed or unstable)REPORT_UNSTABLE_ON_ERROR - runs the publisher even if the mojo had an execution error. In the event of a mojo execution error the build will be marked UNSTABLEAll that&amp;rsquo;s left is are the methods to tie these all together:package hudson.plugins.helpers;&amp;hellip;public abstract class AbstractMavenReporterImpl extends MavenReporter { &amp;hellip;. public boolean preExecute(MavenBuildProxy build, MavenProject pom, MojoInfo mojo, BuildListener listener) throws InterruptedException, IOException { return !isAutoconfMojo(mojo) || autoconfPom(build, pom, mojo, listener); } public boolean postExecute(MavenBuildProxy build, MavenProject pom, MojoInfo mojo, BuildListener listener, Throwable error) throws InterruptedException, IOException { if (!isExecutingMojo(mojo)) { // not a mojo who&amp;rsquo;s result we are interested in return true; } final Boolean okToContinue = getExecutionMode() .isOkToContinue(this, build, listener, error); if (okToContinue != null) { return okToContinue; } build.registerAsProjectAction(this); return BuildProxy.doPerform(newGhostwriter(pom, mojo), build, pom, listener); }}The preExecute method checks if this is an mojo execution that we want to tweak, executing the tweaks if necessary. The postExecute method checks if this the the mojo we want to report on. Then it checks if there were execution errors, following the execution mode reported by getExecutionMode. We register this MavenReporter as a project action (thus signalling Hudson that it should call the getProjectAction() method of our reporter. We will have this method return null if we actually don&amp;rsquo;t want a project action. This is safer than trying to be smart and only calling register if we want a project action!). Finally we invoke the Ghostwriter!SummaryWell that&amp;rsquo;s it for Part 4. In the next installment, I will introduce a DRY set of classes for the reports that the publisher will generate&lt;/p&gt;</description></item><item><title>Writing a Hudson plug-in (Part 5 – Reporting)</title><link>https://stephenc.github.io/post/2008-02-01-writing-a-hudson-plug-in-part-5-reporting/</link><pubDate>Fri, 01 Feb 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-02-01-writing-a-hudson-plug-in-part-5-reporting/</guid><description>&lt;p&gt;Until now we have been generating classes that collect the results we want to display. We have not hooked into Hudson&amp;rsquo;s methods of displaying reports. There are essentially four places that we could want to generate reports:In each individual build (we&amp;rsquo;ll call this a Single Build Report),In the project (we&amp;rsquo;ll call this a Single Project Report),In the summary of all the Maven 2 module builds associated with a multi-module Maven 2 build (we&amp;rsquo;ll call this an Aggregate Build Report), and finallyIn the Maven 2 project itself (we&amp;rsquo;ll call this an Aggregate Project Report).To make matters more confusing, each of these reports usually to implement different classes and need to implement different interfaces:Project Reports usually inherit from ActionableBuild Reports usually inherit from HealthReportingActionSingle Build Reports in Maven 2 projects need to implement AggregatableActionWhat we need is to put some common framework around these reports to ensure that we are not repeating ourselves all the time. In general, each of these four reports will be doing mostly the same things.The Build Reports will be displaying the results for a specific buildThe Project Reports will be displaying the results for the latest build (and possibly a trend chart if that makes sense)The Aggregate Reports will be displaying the aggregate of all the Single ReportsSound&amp;rsquo;s like a job for multiple inheritance! Fortune would have it that Java does not support multiple inheritance, so we will have to use some form of composition to get the same effect, and generics can help reduce the repetition too. But enough! On to the solution.AbstractBuildActionWe&amp;rsquo;ll start with a parent class for all our Build Reports. We&amp;rsquo;ll make this class generic, parameterised by the Build class that it operates on, so that we can use the same core code for all the Build Reports:package hudson.plugins.helpers;import hudson.model.AbstractBuild;import hudson.model.HealthReportingAction;public abstract class AbstractBuildAction&amp;lt;BUILD extends AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;gt; implements HealthReportingAction { private BUILD build = null; protected AbstractBuildAction() { } public synchronized BUILD getBuild() { return build; } public synchronized void setBuild(BUILD build) { if (this.build == null &amp;amp;&amp;amp; this.build != build) { this.build = build; } }}We store a reference to the build in a local variable and provide a getter for the build. Ideally we would like to the build variable to be final and initialize it in the constructor. However, Hudson&amp;rsquo;s remoting interface will get in the way of this for any actions created on the slave. The solution is to use a setter to set the build. Additionally, we have some logic that makes this setter write-once. This is just a safety net to stop us from accidentally confusing Hudson. Strictly speaking, if you are careful the setter can be justa a simple setter and not write once.[Correction] We also need to modify BuildProxy so that it calls our setter for us for actions added from slave side executions:package hudson.plugsin.helpers;&amp;hellip;public final class BuildProxy implements Serializable { &amp;hellip; private final List&amp;lt;AbstractBuildAction&amp;lt;AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;raquo; actions = new ArrayList&amp;lt;AbstractBuildAction&lt;!-- raw HTML omitted --&gt;&amp;raquo;(); &amp;hellip; public void updateBuild(AbstractBuild&amp;lt;,?&amp;gt; build) { for (AbstractBuildAction&amp;lt;AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;gt; action: actions) { if (!build.getActions().contains(action)) { action.setBuild(build); build.getActions().add(action); } } if (result != null &amp;amp;&amp;amp; result.isWorseThan(build.getResult())) { build.setResult(result); } } &amp;hellip; public List&amp;lt;AbstractBuildAction&amp;lt;AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;raquo; getActions() { return actions; } &amp;hellip;}[/Correction]In addition to these simple getters and setters, we want to provide a framework for displaying the report detail. Each different type of report has different ways of fitting into the Hudson UI. We are going to attempt to standardise these by using wrapper .jelly files to call a standard set which implementing classes can override. Jelly files are stored as resources in the hudson plugin, so with the Maven2 project structure for a Hudson plugin, the java source is /src/main/java/hudson/plugins/helpers/AbstractBuildAction.java and the jelly files for this java class are in /src/main/resources/hudson/plugins/helpers/AbstractBuildAction/. The basic things that all build reports want to do are as follows:A main report detail page (e.g. package level summary of the number of lines of code)A graph of some sort, with the option to enlarge it. (e.g. trend graph of the number of lines of code)A simple summary of the report for the main page (i.e. &amp;ldquo;17,345 lines of code (+1,534)&amp;quot;)We will implement this functionality with some properties of the AbstractBuildAction, and some default .jelly files. First the additional properties:&amp;hellip;public abstract class AbstractBuildAction&amp;lt;BUILD extends AbstractBuild&lt;!-- raw HTML omitted --&gt;&amp;gt; implements HealthReportingAction { &amp;hellip; public boolean isFloatingBoxActive() { return false; } public boolean isGraphActive() { return false; } public String getGraphName() { return getDisplayName(); } public String getSummary() { return &amp;ldquo;&amp;rdquo;; }}These four properties will be used to control how the action appears. isFloatingBoxActive allows us to enable the floating box on the build summary page. isGraphActive allows us to activate the graph inside the floating box. getGraphName should return the title that will be displayed above the graph. And finally, getSummary will control the summary text to display beside the build report icon on the build summary page.Next we have some empty default place-holder jelly files. These will be the jelly files that we can override in our actual reports:reportDetail.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;rdquo; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;normalGraph.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;largeGraph.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;The reportDetail.jelly page will be used for the main report detail page, the normalGraph.jelly page will be used for the floating trend graph, while the largeGraph.jelly page will be used for the enlarged graph. To hook these pages into the Hudson framework, we need the following jelly pages:index.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot; css=&amp;quot;/plugin/javancss/css/style.css&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.build}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.displayName}&lt;!-- raw HTML omitted --&gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;st:include page=&amp;ldquo;reportDetail.jelly&amp;rdquo;/&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;This page will also include the trend graph if it is activefloatingBox.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; ${from.graphName} &lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;enlarge&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;/j:if&amp;gt;&amp;lt;/j:jelly&amp;gt;summary.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot; xmlns:i=&amp;ldquo;jelly:fmt&amp;rdquo;&amp;gt; &amp;lt;t:summary icon=&amp;quot;${it.iconFileName}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.displayName}&lt;!-- raw HTML omitted --&gt; ${it.summary} &amp;lt;/t:summary&amp;gt; &amp;lt;j:if test=&amp;quot;${it.floatingBoxVisible}}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;floatingBox.jelly&amp;rdquo;/&amp;gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;/j:if&amp;gt;&amp;lt;/j:jelly&amp;gt;Note that the build main page does not support floating boxes, so we have to hack it in via the summary.jelly pageenlargedGraph.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot; css=&amp;quot;/plugin/javancss/css/style.css&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.build}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;largeGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;AbstractProjectActionThis is similar to AbstractBuildAction, however, we don&amp;rsquo;t have to deal with the write-once setter problem.package hudson.plugins.helpers;import hudson.model.AbstractProject;import hudson.model.Actionable;abstract public class AbstractProjectAction&amp;lt;PROJECT extends AbstractProject&lt;!-- raw HTML omitted --&gt;&amp;gt; extends Actionable { private final PROJECT project; protected AbstractProjectAction(PROJECT project) { this.project = project; } public PROJECT getProject() { return project; } public boolean isFloatingBoxActive() { return true; } public boolean isGraphActive() { return false; } public String getGraphName() { return getDisplayName(); }}Again we have a set of jelly files, we&amp;rsquo;ll repeat the same placeholders:reportDetail.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;normalGraph.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;largeGraph.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt;&amp;lt;/j:jelly&amp;gt;The other link in pages are similar, only changing from a reference for ${it.build} to ${it.project}index.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot; css=&amp;quot;/plugin/javancss/css/style.css&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.project}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.displayName}&lt;!-- raw HTML omitted --&gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;st:include page=&amp;ldquo;reportDetail.jelly&amp;rdquo;/&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;floatingBox.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot; xmlns:i=&amp;ldquo;jelly:fmt&amp;rdquo; xmlns:local=&amp;ldquo;local&amp;rdquo;&amp;gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; ${from.graphName} &lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;normalGraph.jelly&amp;rdquo;/&amp;gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;enlarge&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;/j:if&amp;gt;&amp;lt;/j:jelly&amp;gt;The project page automatically includes the floating box, so we don;t require the summary hackenlargedGraph.jelly&amp;lt;j:jelly xmlns:j=&amp;ldquo;jelly:core&amp;rdquo; xmlns:st=&amp;ldquo;jelly:stapler&amp;rdquo; xmlns:d=&amp;ldquo;jelly:define&amp;rdquo; xmlns:l=&amp;quot;/lib/layout&amp;quot; xmlns:t=&amp;quot;/lib/hudson&amp;quot; xmlns:f=&amp;quot;/lib/form&amp;quot;&amp;gt; &amp;lt;l:layout xmlns:plugin=&amp;quot;/hudson/plugins/javancss/tags&amp;quot; css=&amp;quot;/plugin/javancss/css/style.css&amp;quot;&amp;gt; &amp;lt;st:include it=&amp;quot;${it.project}&amp;quot; page=&amp;ldquo;sidepanel.jelly&amp;rdquo;/&amp;gt; &amp;lt;l:main-panel&amp;gt; &amp;lt;j:if test=&amp;quot;${it.graphActive}&amp;quot;&amp;gt; &lt;!-- raw HTML omitted --&gt;${it.graphName}&lt;!-- raw HTML omitted --&gt; &amp;lt;st:include page=&amp;ldquo;largeGraph.jelly&amp;rdquo;/&amp;gt; &amp;lt;/j:if&amp;gt; &amp;lt;/l:main-panel&amp;gt; &amp;lt;/l:layout&amp;gt;&amp;lt;/j:jelly&amp;gt;SummaryThat&amp;rsquo;s it for part 5, next time we will implement the javancss parser and get the results for a build. Part 7 will finish off the plugin with the reports based on these two base classes.&lt;/p&gt;</description></item><item><title>Writing a Hudson plug-in (Part 1 – Preparation)</title><link>https://stephenc.github.io/post/2008-01-13-writing-a-hudson-plug-in-part-1-preparation/</link><pubDate>Sun, 13 Jan 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-01-13-writing-a-hudson-plug-in-part-1-preparation/</guid><description>&lt;p&gt;Writing a Hudson plug-in (Part 1 – Preparation)This is the first part of a tutorial on writing a Hudson plug-in. The aim of this tutorial is to develop a Publisher for JavaNCSS. This publisher will work with both Hudson Freestyle projects and Hudson Maven2 projects. The publisher will also include a trend graph.Before we can start plug-in development, we need to have a set of working projects to throw at our plugin. Ideally these projects should be simple and quick to build, but the most essential thing is that they build and run the tool that we want to publish the results of! We need a minimum of three projects:Ant-based projectMaven2-based single module projectMaven2-based multiple module projectSo we will develop these three basic projects, get them running the JavaNCSS tool, and then ensure they build in Hudson.The Ant-based projectWe’ll start with the Ant based project. First we’ll need a directory structure:project/ src/ main/ test/ lib/ tools/ javancss/Next we need to download the library dependencies to the lib folder (for example junit.jar) and the custom ant tasks to the appropriate sub-folder of tools.You can get JUnit.jar from &lt;a href="http://www.junit.org"&gt;http://www.junit.org&lt;/a&gt;.The JavaNCSS jars are available at &lt;a href="http://www.kclee.de/clemens/java/javancss/"&gt;http://www.kclee.de/clemens/java/javancss/&lt;/a&gt; (Note this is the .de domain, not the .com domain). JavaNCSS comes as a zip file, so we’ll just extract the three jar files that we need: ccl.jar, javancss.jar and jhbasic.jarAt this point we should have the followingproject/ src/ main/ test/ lib/ junit.jar tools/ javancss/ ccl.jar javancss.jar jhbasic.jarNext we need a build file, and some sample java files to build. Here is a sample build.xml that will do most of what we want:&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &amp;lt;pathelement location=&amp;quot;${basedir}/tools/javancss/jhbasic.jar&amp;quot; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;We can then write some simple java classes and test our build. We’ll start with a simple HelloWorld.javapackage com.onedash.hello;/*** A basic hello world application.** @author Stephen Connolly*/public class Hello { public String sayHello(String name) { return &amp;ldquo;Hello &amp;quot; + name; } public static void main(String[] args) { Hello instance = new Hello(); if (args.length == 1) { System.out.println(instance.sayHello(args[0])); } else { System.out.println(instance.sayHello(&amp;ldquo;world&amp;rdquo;)); } }}At this point we should have the following project structure:project/ build.xml src/ main/ com/ onedash/ hello/ Hello.java test/ lib/ junit.jar tools/ javancss/ ccl.jar javancss.jar jhbasic.jarAnd running ANT should give output like:C:\local\project&amp;gt;ant clean distBuildfile: build.xmlclean:[delete] Deleting directory C:\local\project\build[delete] Deleting directory C:\local\project\distcompile: [mkdir] Created dir: C:\local\project\build\classes [javac] Compiling 5 source files to C:\local\project\build\classescompile-tests: [mkdir] Created dir: C:\local\project\build\testcases [javac] Compiling 1 source file to C:\local\project\build\testcasestest: [mkdir] Created dir: C:\local\project\build\testcases\reportsjavancss:[javancss] Generating reportdist: [mkdir] Created dir: C:\local\project\dist [jar] Building jar: C:\local\project\dist\SimpleAntProject.jarBUILD SUCCESSFULTotal time: 3 secondsAnd there should be a javancss-report.xml file in the build directory. That should be enough for an ANT project. Some extra finesse would be to add some more source code so we can examine the structure of the xml report.The Maven2 based single module projectFirst we’ll need a directory structure:project/ src/ main/ java/ test/ java/Next we need a pom.xml to describe the project for Maven2. Here is a simple pom.xml:&lt;!-- raw HTML omitted --&gt; xsi:schemaLocation=&amp;ldquo;&lt;a href="http://maven.apache.org/POM/4.0.0"&gt;http://maven.apache.org/POM/4.0.0&lt;/a&gt; &lt;a href="http://maven.apache.org/maven-v4_0_0.xsd%22%3E"&gt;http://maven.apache.org/maven-v4_0_0.xsd&amp;quot;&amp;gt;&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;4.0.0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.hudson&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;SimpleM2Project&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;SimpleM2Project&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1.0-SNAPSHOT&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;jar&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;junit&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;junit&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;4.4&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;test&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;package&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;org.codehaus.mojo&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;javancss-maven-plugin&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;process-sources&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;report&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;We can reuse the Hello.java from the Ant project, so at this point we should have the following directory structure:project/ pom.xml src/ main/ java/ com/ onedash/ hello/ Hello.java test/ java/And running maven should give the following output:C:\local\project&amp;gt;mvn clean package[INFO] Scanning for projects&amp;hellip;[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] Building SimpleM2Project[INFO] task-segment: [clean, package][INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] [clean:clean][INFO] Deleting directory C:\local\project\target[INFO] Deleting directory C:\local\project\target\classes[INFO] Deleting directory C:\local\project\target\test-classes[INFO] Deleting directory C:\local\project\target\site[INFO] [javancss:report {execution: default}][WARNING] Unable to locate Source XRef to link to - DISABLED[INFO] [resources:resources][INFO] Using default encoding to copy filtered resources.[INFO] [compiler:compile][INFO] Compiling 1 source files to C:\local\project\target\classes[INFO] [resources:testResources][INFO] Using default encoding to copy filtered resources.[INFO] [compiler:testCompile][INFO] Nothing to compile - all classes are up to date[INFO] [surefire:test][INFO] No tests to run.[INFO] [jar:jar][INFO] Building jar: C:\local\project\target\SimpleM2Project-1.0-SNAPSHOT.jar[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] BUILD SUCCESSFUL[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] Total time: 5 seconds[INFO] Finished at: Sun Jan 13 22:06:20 GMT 2008[INFO] Final Memory: 5M/10M[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;And there should be a javancss-raw-report.xml file in the target directory.The Maven2 based multi-module projectWe can generate this project in its simplest form just by adding the simple project as a child of a project with &lt;!-- raw HTML omitted --&gt;pom&lt;!-- raw HTML omitted --&gt;. We’ll start off with the following directory structure:project/ SimpleM2Project pom.xml src/ main/ java/ com/ onedash/ hello/ Hello.java test/ java/Where the SimpleM2Project subtree is a copy of the previous project. All we now need is a pom.xml to nest this project in:&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;4.0.0&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;com.onedash.mvn.hudson&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;MultiM2Project&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;MultiM2Project&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1.0-SNAPSHOT&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;pom&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;SimpleM2Project&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;And running maven should give the following output:C:\local\project&amp;gt;mvn clean package[INFO] Scanning for projects&amp;hellip;[INFO] Reactor build order:[INFO] SimpleM2Project[INFO] MultiM2Project[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] Building SimpleM2Project[INFO] task-segment: [clean, package][INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] [clean:clean][INFO] Deleting directory C:\local\project\SimpleM2Project\target[INFO] Deleting directory C:\local\project\SimpleM2Project\target\classes[INFO] Deleting directory C:\local\project\SimpleM2Project\target\test-classes[INFO] Deleting directory C:\local\project\SimpleM2Project\target\site[INFO] [javancss:report {execution: default}][WARNING] Unable to locate Source XRef to link to - DISABLED[INFO] [resources:resources][INFO] Using default encoding to copy filtered resources.[INFO] [compiler:compile][INFO] Compiling 1 source files to C:\local\project\SimpleM2Project\target\classes[INFO] [resources:testResources][INFO] Using default encoding to copy filtered resources.[INFO] [compiler:testCompile][INFO] No sources to compile[INFO] [surefire:test][INFO] No tests to run.[INFO] [jar:jar][INFO] Building jar: C:\local\project\SimpleM2Project\target\SimpleM2Project-1.0-SNAPSHOT.jar[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] Building MultiM2Project[INFO] task-segment: [clean, package][INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] [clean:clean][INFO] Deleting directory C:\local\project\target[INFO] Deleting directory C:\local\project\target\classes[INFO] Deleting directory C:\local\project\target\test-classes[INFO] Deleting directory C:\local\project\target\site[INFO] [site:attach-descriptor][INFO][INFO][INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] Reactor Summary:[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] SimpleM2Project &amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip; SUCCESS [7.240s][INFO] MultiM2Project &amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;. SUCCESS [2.754s][INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] BUILD SUCCESSFUL[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] Total time: 10 seconds[INFO] Finished at: Sun Jan 13 22:16:37 GMT 2008[INFO] Final Memory: 7M/15M[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;And there should be a javancss-raw-report.xml file in the SimpleM2Project/target directory.The Hudson setupWe’ll start by running mvn hpi:create to create a base to work from:C:\local&amp;gt;mvn hpi:create[INFO] Scanning for projects&amp;hellip;[INFO] Searching repository for plugin with prefix: &amp;lsquo;hpi&amp;rsquo;.[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] Building Maven Default Project[INFO] task-segment: [hpi:create] (aggregator-style)[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-&amp;hellip;[INFO] [hpi:create]Enter the groupId of your plugin: org.jvnet.hudson.plugins[INFO] Defaulting package to group ID: org.jvnet.hudson.pluginsEnter the artifactId of your plugin: javancss&amp;hellip;[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] BUILD SUCCESSFUL[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;[INFO] Total time: 2 minutes 44 seconds[INFO] Finished at: Sun Jan 13 22:34:58 GMT 2008[INFO] Final Memory: 8M/15M[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;The result should be a sub-directory called javancss with a pom.xml file and a basic Hudson plugin starting point. We’ll edit the pom.xml to update the version of Hudson to the latest (at the time of writing 1.170) and launch a live development instance to set our projects up in.Open up the pom.xml file, and change the &lt;!-- raw HTML omitted --&gt;1.153&lt;!-- raw HTML omitted --&gt; tags for the hudson-core and hudson-war dependencies to 1.170.The dependency section should now look like this:&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;org.jvnet.hudson.main&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;hudson-core&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1.170&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;provided&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;org.jvnet.hudson.main&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;hudson-war&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;war&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;1.170&lt;!-- raw HTML omitted --&gt; &lt;!-- raw HTML omitted --&gt;test&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;Next launch a copy of Hudson by running mvn hpi:runC:\local\javancss&amp;gt;mvn hpi:run[INFO] Scanning for projects&amp;hellip;[INFO] Searching repository for plugin with prefix: &amp;lsquo;hpi&amp;rsquo;.[INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] Building Unnamed - org.jvnet.hudson.plugins:javancss:hpi:1.0-SNAPSHOT[INFO] task-segment: [hpi:run][INFO] &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-[INFO] Preparing hpi:run&amp;hellip;[INFO] Started Jetty Server[INFO] Starting scanner at interval of 1 seconds.Now fire up a web browser for http://localhost:8080/We want to create five projects: Freestyle project for the Simple Ant projectFreestyle project for the Single module Maven2 projectFreestyle project for the Multi-module Maven2 projectMaven2 project for the Single module Maven2 projectMaven2 project for the Multi-module Maven2 projectFor extra finesse, we can add a slave executor, and create a second set of these projects tied to the slave. An final extra project that does nothing other than trigger all the other projects to build is the icing on the cake.&lt;/p&gt;</description></item><item><title>Writing a Hudson plug-in (Part 2 – Understanding m2 and freestyle projects)</title><link>https://stephenc.github.io/post/2008-01-01-writing-a-hudson-plug-in-part-2-understanding-m2-and-freestyle-projects/</link><pubDate>Tue, 01 Jan 2008 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2008-01-01-writing-a-hudson-plug-in-part-2-understanding-m2-and-freestyle-projects/</guid><description>&lt;p&gt;Before we proceed with developing the plugin, there is an important concept to understand: How the different project types invoke their plugins.Currently, one of the biggest source of confusion for end users of Hudson is that most of the plugins do not work with the &amp;ldquo;m2 project type&amp;rdquo;. This is because there are essentially two completely different implementations of plugins.&amp;ldquo;Normal&amp;rdquo; Plugins&amp;quot;Normal&amp;quot; plugins work with all project types except the &amp;ldquo;m2 project type&amp;rdquo;. Typically they will extend Publisher. The model of execution is that the Publisher is invoked on the Hudson Master and can invoke actions remotely on the slave.The plugin author must be mindfull that they do not overload the master with excessive work, either by minimising the amount of work to be performed, or by sending work to the slave for execution. Best performance will be achieved if the heavy lifting is performed on the slave and then finally the results are sent to the master. Multiple trips back and forth between the master and the slave will not be performant.&amp;ldquo;Maven&amp;rdquo; Plugins&amp;quot;Maven&amp;quot; plugins only work with the &amp;ldquo;m2 project type&amp;rdquo;. They must extend MavenReporter. Contrary to the &amp;ldquo;Normal&amp;rdquo; plugins, they are executed on the Slave. This is because they are invoked as call-backs from the Maven Embedded that is running on the slave. If the MavenReporter is able to invoke actions remotely on the Master.The plugin author does not have to be as mindful about overloading the master, as by default, they are executing on the slave, however, the side effect is that the plugin does not have full access to all the Hudson objects, and must usually send work to the master, e.g. to add an Action to a build, it is necessary to serialize the Action, send it to the master along with a Callable that then takes the deserialized Action and adds it to the real Build. (Note: Adding an action is such a common task that BuildProxy provides convenience methods to do this for us)Don&amp;rsquo;t Repeat YourselfThe result of this split is that it can be difficult to keep the DRY principles when developing Hudson plugins. Looking at what all plugins do, though, there is a standard pattern for most Publishing plugins:Determine where the information to be published is to be foundProcess/extract the information on the slaveSend the persistent result of the build to the masterFinalize processing of the information on the masterStrictly speaking only one of the last two steps is required, however, in most cases there is a trade-off between tasks that are more performant when executed on the slave and tasks that must be performed on the master as either the required information is not available on the slave or the activity will affect the object instances on the master as an artifact of the serialization call-by-value that occurs on the slave.Thus to keep the DRY principles we need to:Publisher or MavenReporter constructs a Configuration object.If the Configuration requires tasks to execute on the slave, ensure that it is sent to the slave and execute those tasks on the slave.If the Configuration requires tasks to execute on the master, send it (if necessary back) to the master and execute those tasks on the master.There are other issues with respect to Actions, i.e. Actions for a &amp;ldquo;m2 project type&amp;rdquo; must extend a specific subclass. However, this is not a problem, as there is nothing to stop us just having all the actions extend this type, the non-&amp;ldquo;m2 project type&amp;rdquo; usage will just ignore that it&amp;rsquo;s extending the subclass.What&amp;rsquo;s nextIn part 3, I will present a couple of wrapper classes that we can use to ensure that the DRY principle gives us plugin execution in one place. Part 4 will tie these wrapper classes into the Hudson plugin framework, giving us a MavenReporter and a Publisher that both use common code to deliver the plugin functionality. Part 5 will add aggregated reporting for m2 project. Part 6 will add simple trend graphs. Part 7 will close out by actually parsing the JavaNCSS files and implementing our plugin!&lt;/p&gt;</description></item><item><title>Sventon and Hudson</title><link>https://stephenc.github.io/post/2007-11-14-sventon-and-hudson/</link><pubDate>Wed, 14 Nov 2007 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2007-11-14-sventon-and-hudson/</guid><description>&lt;p&gt;This morning I discovered sventon (&lt;a href="http://www.sventon.org"&gt;http://www.sventon.org&lt;/a&gt;) a Subversion (&lt;a href="http://subversion.tigris.org/"&gt;http://subversion.tigris.org/&lt;/a&gt;) repository browser written in Java. And it&amp;rsquo;s free! Ten minutes later I had this integrated as a Repository browser in Hudson (&lt;a href="https://hudson.dev.java.net/"&gt;https://hudson.dev.java.net/&lt;/a&gt; will be available in build 1.157) and I&amp;rsquo;m loving it. It&amp;rsquo;s not quite as good as fisheye&amp;hellip; but it does everything I need it to!&lt;/p&gt;
&lt;p&gt;Hudson is &lt;em&gt;really&lt;/em&gt; starting to have kick-ass features that leave everything else for dust.&lt;/p&gt;</description></item><item><title>Hudson Coverage plugin</title><link>https://stephenc.github.io/post/2007-11-06-hudson-coverage-plugin/</link><pubDate>Wed, 07 Nov 2007 00:00:00 +0000</pubDate><guid>https://stephenc.github.io/post/2007-11-06-hudson-coverage-plugin/</guid><description>&lt;p&gt;Note to self, here are some code coverage tools for .NET that are free to use&amp;hellip; and therefore good candidates for having the Coverage plugin for Hudson support off the shelf:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://sourceforge.net/projects/partcover/"&gt;http://sourceforge.net/projects/partcover/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://www.gotdotnet.com/Community/UserSamples/Details.aspx?SampleGuid=881a36c6-6f45-4485-a94e-060130687151"&gt;http://www.gotdotnet.com/Community/UserSamples/Details.aspx?SampleGuid=881a36c6-6f45-4485-a94e-060130687151&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>