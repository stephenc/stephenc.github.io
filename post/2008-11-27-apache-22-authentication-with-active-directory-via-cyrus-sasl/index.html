<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width"><script type=application/javascript src=https://stephenc.github.io/js/theme-mode.js></script><link rel=stylesheet href=https://stephenc.github.io/css/frameworks.min.css><link rel=stylesheet href=https://stephenc.github.io/css/github.min.css><link rel=stylesheet href=https://stephenc.github.io/css/github-style.css><link rel=stylesheet href=https://stephenc.github.io/css/light.css><link rel=stylesheet href=https://stephenc.github.io/css/dark.css><link rel=stylesheet href=https://stephenc.github.io/css/syntax.css><title>Apache 2.2 Authentication with Active Directory via Cyrus SASL - Stephen's technical blog</title><link rel=icon type=image/x-icon href=https://stephenc.github.io/images/favicon.ico><meta name=theme-color content="#1e2327"><meta name=description content="Here is my version of the holy grail, i.e.
Authentication for Apache HTTPD against Active Directory.
This is not the only way to skin this cat, for example you could also use Sander Marechal&rsquo;s technique (which uses mod_authnz_ldap). However, my problem with Sander&rsquo;s technique is that you need to have an account in Active Directory which you will use to bind to the LDAP server. That means that the accound password has to be stored in a plain-text file on the Apache server, and if the password expires everything breaks until you go fix the password.
"><meta name=keywords content='blog'><meta name=robots content="noodp"><link rel=canonical href=https://stephenc.github.io/post/2008-11-27-apache-22-authentication-with-active-directory-via-cyrus-sasl/><meta name=twitter:card content="summary"><meta name=twitter:title content="Apache 2.2 Authentication with Active Directory via Cyrus SASL - Stephen's technical blog"><meta name=twitter:description content="Here is my version of the holy grail, i.e.
Authentication for Apache HTTPD against Active Directory.
This is not the only way to skin this cat, for example you could also use Sander Marechal&rsquo;s technique (which uses mod_authnz_ldap). However, my problem with Sander&rsquo;s technique is that you need to have an account in Active Directory which you will use to bind to the LDAP server. That means that the accound password has to be stored in a plain-text file on the Apache server, and if the password expires everything breaks until you go fix the password.
"><meta name=twitter:site content="https://stephenc.github.io/"><meta name=twitter:creator content><meta name=twitter:image content="https://stephenc.github.io/"><meta property="og:type" content="article"><meta property="og:title" content="Apache 2.2 Authentication with Active Directory via Cyrus SASL - Stephen's technical blog"><meta property="og:description" content="Here is my version of the holy grail, i.e.
Authentication for Apache HTTPD against Active Directory.
This is not the only way to skin this cat, for example you could also use Sander Marechal&rsquo;s technique (which uses mod_authnz_ldap). However, my problem with Sander&rsquo;s technique is that you need to have an account in Active Directory which you will use to bind to the LDAP server. That means that the accound password has to be stored in a plain-text file on the Apache server, and if the password expires everything breaks until you go fix the password.
"><meta property="og:url" content="https://stephenc.github.io/post/2008-11-27-apache-22-authentication-with-active-directory-via-cyrus-sasl/"><meta property="og:site_name" content="Apache 2.2 Authentication with Active Directory via Cyrus SASL"><meta property="og:image" content="https://stephenc.github.io/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2008-11-27 00:00:00 +0000 UTC"></head><body><div style=position:relative><header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"><div class="Header-item mobile-none" style=margin-top:-4px;margin-bottom:-4px><a class=Header-link href=https://stephenc.github.io/><img class=octicon height=32 width=32 src=/images/top-icon.png></a></div><div class="Header-item d-md-none"><button class="Header-link btn-link js-details-target" type=button onclick='document.querySelector("#header-search").style.display=document.querySelector("#header-search").style.display=="none"?"block":"none"'>
<svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button></div><div style=display:none id=header-search class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"><div class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"><div class=position-relative><form target=_blank id=search-form accept-charset=UTF-8 method=get autocomplete=off><label class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"><input type=text class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable" name=q placeholder=Search autocomplete=off></label></form></div></div></div><div class="Header-item Header-item--full flex-justify-center d-md-none position-relative"><a class=Header-link href=https://stephenc.github.io/><img class="octicon octicon-mark-github v-align-middle" height=32 width=32 src=/images/top-icon.png></a></div><div class=Header-item style=margin-right:0><a href=javascript:void(0) class="Header-link no-select" onclick=switchTheme()><svg style="fill:var(--color-profile-color-modes-toggle-moon)" class="no-select" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52208 7.71754c3.05612.0 5.53362-2.47748 5.53362-5.5336C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961 9.95801 1.07727 10.3495.771159 10.6474.99992c1.4679 1.12724 2.4141 2.90007 2.4141 4.89391.0 3.40575-2.7609 6.16667-6.16665 6.16667-2.94151.0-5.40199-2.0595-6.018122-4.81523C.794841 6.87902 1.23668 6.65289 1.55321 6.85451 2.41106 7.40095 3.4296 7.71754 4.52208 7.71754z"/></svg></a></div></header></div><div id=search-result class="container-lg px-3 new-discussion-timeline" style=display:none></div><div class=application-main><div><main><div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4"><div class=px-0><div class="mb-3 d-flex px-3 px-md-3 px-lg-5"><div class="flex-auto min-width-0 width-fit mr-3"><div class=d-flex><div class="d-none d-md-block"><a class="avatar mr-2 flex-shrink-0" href=https://stephenc.github.io/><img class=avatar-user src=/images/avatar.jpg width=32 height=32></a></div><div class="d-flex flex-column"><h1 class="break-word f3 text-normal mb-md-0 mb-1"><span class=author><a href=https://stephenc.github.io/>Stephen Connolly</a>
</span><span class=path-divider>/</span>
<strong class="css-truncate css-truncate-target mr-1" style=max-width:410px><a href=https://stephenc.github.io/post/2008-11-27-apache-22-authentication-with-active-directory-via-cyrus-sasl/>Apache 2.2 Authentication with Active Directory via Cyrus SASL</a></strong></h1><div class="note m-0">Created <relative-time datetime="Thu, 27 Nov 2008 00:00:00 +0000" class=no-wrap>Thu, 27 Nov 2008 00:00:00 +0000</relative-time>
<span class=file-info-divider></span>
Modified <relative-time datetime="Thu, 27 Nov 2008 00:00:00 +0000" class=no-wrap>Thu, 27 Nov 2008 00:00:00 +0000</relative-time></div></div></div></div></div></div></div><div class="container-lg px-3 new-discussion-timeline"><div class="repository-content gist-content"><div><div class="js-gist-file-update-container js-task-list-container file-box"><div id=file-pytest class="file my-2"><div id=post-header class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style=z-index:2><div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0"><summary id=toc-toggle onclick=clickToc() class="btn btn-octicon m-0 mr-2 p-2"><svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered"><path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zM3 8A1 1 0 111 8a1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"/></svg></summary><details-menu class=SelectMenu id=toc-details style="display: none;"><div class="SelectMenu-modal rounded-3 mt-1" style=max-height:340px><div class="SelectMenu-list SelectMenu-list--borderless p-2" style=overscroll-behavior:contain id=toc-list></div></div></details-menu>832 Words</div><div class="file-actions flex-order-2 pt-0"></div></div></div><div class="Box-body px-5 pb-5" style=z-index:1><article class="markdown-body entry-content container-lg"><p>Here is my version of the holy grail, i.e.</p><blockquote><p>Authentication for Apache HTTPD against Active Directory.</p></blockquote><p>This is not the only way to skin this cat, for example you could also use <a href=http://www.jejik.com/articles/2007/06/apache_and_subversion_authentication_with_microsoft_active_directory/>Sander Marechal&rsquo;s technique</a> (which uses <a href=http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html>mod_authnz_ldap</a>). However, my problem with Sander&rsquo;s technique is that you need to have an account in Active Directory which you will use to bind to the LDAP server. That means that the accound password has to be stored in a plain-text file on the Apache server, and if the password expires everything breaks until you go fix the password.</p><p>I want as near to zero maintenance as possible, running on CentOS 5.2 with minimal custom work - so that I don&rsquo;t have to maintain it when it does break.</p><p>I have previously configured Kerberos to authenicate against Active Directory, so my first attempt was with <a href=http://modauthkerb.sourceforge.net/>mod_auth_kerb</a>. That worked&mldr; but very slowly&mldr; trying to an empty access Subversion repository took over 2 minutes. The problem being that successful authentication was not being cached.</p><p>Then I tried using <a href=http://perl.apache.org/>mod_perl</a> and the <a href=http://search.cpan.org/%7Echansen/Authen-Simple-LDAP-0.2/lib/Authen/Simple/ActiveDirectory.pm>Authen::Simple::ActiveDirectory</a> reasoning that I could always hack caching once in perl&mldr; but getting that lot installed on a CentOS 5.2 from RPMs was an exercise in tears.</p><p>So, anyway, I found out that <a href=http://asg.web.cmu.edu/sasl/sasl-library.html>Cyrus SASL</a> supports two modes of LDAP authentication:</p><blockquote><p>The bind method uses the LDAP bind facility to verify the password. The bind method is not available when ldap_use_sasl is turned on. In that case saslauthd will use fastbind.</p><p>&lsquo;bind&rsquo; is the default auth method. When ldap_use_sasl is enabled, &lsquo;fastbind&rsquo; is the default.</p><p>The custom method uses userPassword attribute to verify the password. Suppored hashes: crypt, md5, smd5, sha and ssha. Cleartext is supported as well.</p><p>The fastbind method (when &rsquo;ldap_use_sasl: no&rsquo;) does away with the search and an extra anonymous bind in auth_bind, but makes two assumptions:</p><ol><li>Expanding the ldap_filter expression gives the user&rsquo;s fully-qualified DN</li><li>There is no cost to staying bound as a named user</li></ol></blockquote><p>So bind is pretty much the same technique as that used by <a href=http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html>mod_authnz_ldap</a>, and (as ActiveDirectory does not support - at my company at least - anonymous bind) is ruled out of the running.</p><p>&ldquo;fastbind&rdquo; sounds exactly like what I want&mldr; ok and saslauthd can be configured to cache authentication, so none of the performance hit of <a href=http://modauthkerb.sourceforge.net/>mod_auth_kerb</a>. All we need is a way to tie this into Apache.</p><p>So, enter <a href=http://mod-authn-sasl.sourceforge.net/>mod_authn_sasl</a> which does just that.</p><p>First, we need to create an RPM, so I did a quick</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo yum install httpd-devel rpmbuild mock
</span></span><span style=display:flex><span>sudo
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;%_topdir %(echo </span>$HOME<span style=color:#e6db74>)/rpmbuild&#34;</span> &gt; ~/.rpmmacros
</span></span><span style=display:flex><span>mkdir -p ~/rpmbuild/<span style=color:#f92672>{</span>BUILD,RPMS,SOURCES,SPECS,SRPMS<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>I added my account to the <code>mock</code> group, logged out and in again for the group membership to be recognised and I was ready to go. This was my first experience playing with <a href=http://fedoraproject.org/wiki/Projects/Mock>mock</a>, but it was lovely, especially as CentOS has its own version.</p><p>I pre-primed my mock environments for <code>i386</code> and <code>x86_64</code> as I need RPMs for both of these:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mock -r centos-5-i386 init
</span></span><span style=display:flex><span>mock -r centos-5-x86_64 init
</span></span></code></pre></div><p>Then I downloaded <a href=http://superb-east.dl.sourceforge.net/sourceforge/mod-authn-sasl/mod_authn_sasl-1.0.2.tar.bz2>mod_authn_sasl-1.0.2.tar.bz2</a> and started writing my spec file.</p><p>You can download the RPC spec: <a href=http://www.one-dash.com/blog/mod_authn_sasl.spec>mod_authn_sasl.spec</a> and the apache config file: <a href=http://www.one-dash.com/blog/mod_authn_sasl.conf>mod_authn_sasl.conf</a>.</p><p>I put <a href=http://superb-east.dl.sourceforge.net/sourceforge/mod-authn-sasl/mod_authn_sasl-1.0.2.tar.bz2>mod_authn_sasl-1.0.2.tar.bz2</a> and <a href=http://www.one-dash.com/blog/mod_authn_sasl.conf>mod_authn_sasl.conf</a> in the <code>~/rpmbuild/SOURCES</code> and then running</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>rpmbuild -ba mod_authn_sasl.spec
</span></span></code></pre></div><p>produced <a href=http://www.one-dash.com/blog/mod_authn_sasl-1.0.2-4.src.rpm>my source RPM</a>, then I used mock to create the two binary RPMs that I needed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mock -r centos-5-i386 ~/rpmbuild/SRPMS/mod_authn_sasl-1.0.2-4.src.rpm
</span></span><span style=display:flex><span>mock -r centos-5-x86_64 ~/rpmbuild/SRPMS/mod_authn_sasl-1.0.2-4.src.rpm
</span></span></code></pre></div><p>The rpms built from the mock environments end up in <code>/var/lib/mock/centos-5-i386/result</code> and <code>/var/lib/mock/centos-5-x86_64/result</code>. If you want to be lazy and trust my binaries here they are:</p><ul><li><a href=http://www.one-dash.com/blog/mod_authn_sasl-1.0.2-4.i386.rpm>mod_authn_sasl-1.0.2-4.i386.rpm</a></li><li><a href=http://www.one-dash.com/blog/mod_authn_sasl-1.0.2-4.x86_64.rpm>mod_authn_sasl-1.0.2-4.x86_64.rpm</a></li></ul><p>Now all we need to do is configure everything.</p><p>&rsquo;ve written <a href=http://www.one-dash.com/blog/system-saslauthd-active-directory-config.sh>this shell script</a> to simplify configuring saslauthd for most good deployments of Active Directory, i.e. where there are <code>SRV</code> records for the domain in your DNS server. You need to run it as root. It looks up the <code>SRV</code> records for the domain name you provide, and creates <code>/etc/saslauthd.conf</code> from them, assuming that the Active Directory domain name is the first word of your DNS name converted to uppercase. So for example, if your Active Directory is set up correctly, and you can login to windows as either <code>EXAMPLE\joebloggs</code> or <code>jbloggs@example.foo.com</code> then you would run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sh system-saslauthd-active-directory-config.sh example.foo.com
</span></span></code></pre></div><p>And that <em>should</em> setup <code>saslauthd</code> for you. You can test this using the <code>testsaslauthd</code> program.</p><p>Then all you need to do is secure the appropriate locations in apache, e.g. by adding the following to your VirtualHost configuration:</p><pre tabindex=0><code>&lt;Location /private&gt;
  AuthSaslPwcheckMethod saslauthd
  AuthSaslAppname httpd
  AuthSaslRealm example
  AuthType basic
  AuthBasicProvider sasl
  AuthBasicAuthoritative On
  AuthName &#34;sasl@example.com&#34;
  require valid-user
&lt;/Location&gt;
</code></pre><p>And define the SASL application provider for the <code>AuthSaslAppname</code> you specified, e.g. for the above configuration you need to create <code>/usr/lib/sasl2/httpd.conf</code> with the contents:</p><pre tabindex=0><code>pwcheck_method:saslauthd
</code></pre><p>That&rsquo;s it. You should be done.</p><p><strong>Updated Friday 28th November 2008:</strong> I noticed that the spec file I had provided did not have the correct <code>Requires</code> and <code>BuildRequires</code>. I have fixed this and now I have posted updated rpms (these are <code>1.0.2-4</code>) with the correct requires to help with a minimal install</p></article></div></div></div></div></div></div></main></div><script type=application/javascript src=https://stephenc.github.io/js/toc.js></script><link rel=stylesheet href=https://stephenc.github.io/css/toc.css></div><footer style="text-align:center;padding:20px;border-top:1px solid #eee;margin-top:40px"><p style=margin:0;color:#666;font-size:14px>Â© 2025 Stephen Connolly
| <a href=# onclick="return resetCookieConsent(),!1" style=color:#666;text-decoration:underline>Cookie Settings</a></p></footer><div id=cookie-consent-banner style="display:none;position:fixed;bottom:0;left:0;right:0;background:#333;color:#fff;padding:15px;text-align:center;z-index:9999;box-shadow:0 -2px 10px rgba(0,0,0,.3)"><div style="max-width:1200px;margin:0 auto"><p style="margin:0 0 10px;font-size:14px">This website uses Google Analytics to help analyze how visitors use this site. By continuing to browse this site, you agree to this use.
<a href=# style=color:#4caf50;text-decoration:underline onclick="return showCookieDetails(),!1">Learn more</a></p><div><button onclick=acceptCookies() style="background:#4caf50;color:#fff;border:none;padding:8px 16px;margin:0 5px;cursor:pointer;border-radius:4px">Accept</button>
<button onclick=declineCookies() style="background:#f44336;color:#fff;border:none;padding:8px 16px;margin:0 5px;cursor:pointer;border-radius:4px">Decline</button></div></div></div><div id=cookie-details-modal style=display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:10000><div style=position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:20px;border-radius:8px;max-width:500px;width:90%><h3 style=margin-top:0>Cookie Information</h3><p>This website uses Google Analytics, which uses cookies to collect anonymous information about how visitors use this site. This information is used to improve the website experience.</p><p><strong>What data is collected:</strong></p><ul><li>Pages visited and time spent on pages</li><li>How you arrived at the site</li><li>General location (country/city level)</li><li>Device and browser information</li></ul><p>No personally identifiable information is collected. You can opt out at any time by declining cookies.</p><button onclick=hideCookieDetails() style="background:#2196f3;color:#fff;border:none;padding:8px 16px;cursor:pointer;border-radius:4px">Close</button></div></div><script>function getCookieConsent(){return localStorage.getItem("cookieConsent")}function setCookieConsent(e){localStorage.setItem("cookieConsent",e)}function loadGoogleAnalytics(){var t,e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-CEQZZXVE7Q",document.head.appendChild(e),t=document.createElement("script"),t.innerHTML=`
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CEQZZXVE7Q', {
        anonymize_ip: true,
        cookie_flags: 'SameSite=None;Secure'
      });
    `,document.head.appendChild(t)}function acceptCookies(){setCookieConsent("accepted"),document.getElementById("cookie-consent-banner").style.display="none",loadGoogleAnalytics()}function declineCookies(){setCookieConsent("declined"),document.getElementById("cookie-consent-banner").style.display="none"}function showCookieDetails(){document.getElementById("cookie-details-modal").style.display="block"}function hideCookieDetails(){document.getElementById("cookie-details-modal").style.display="none"}function resetCookieConsent(){localStorage.removeItem("cookieConsent"),document.getElementById("cookie-consent-banner").style.display="block"}document.addEventListener("DOMContentLoaded",function(){var e=getCookieConsent();e==="accepted"?loadGoogleAnalytics():e==="declined"||(document.getElementById("cookie-consent-banner").style.display="block")})</script></body><script type=application/javascript src=https://stephenc.github.io/js/github-style.js></script><script src=https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js></script><script type=application/javascript src=https://stephenc.github.io/js/search.js></script></html>